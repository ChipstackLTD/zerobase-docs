<br>
<br>
<br>

# Giao tiáº¿p CAN Bus sá»­ dá»¥ng module MCP2551

![can-mcp2551-circuit](https://cdn.chipstack.vn/zerobase2/can/can-mcp2551-circuit.jpg)

## Tá»•ng quan

?> BÃ i viáº¿t nÃ y sáº½ hÆ°á»›ng dáº«n báº¡n cÃ¡ch giao tiáº¿p CAN Bus sá»­ dá»¥ng module MCP2551 vá»›i Zerobase 2.

## Chuáº©n bá»‹

| Linh kiá»‡n | Link mua |
| --- | --- |
| Board Zerobase 2|[Mua ngay](https://chipstack.vn/san-pham/zerobase-2/) |
| LCD Character 1602A ná»n xanh dÆ°Æ¡ng | [Mua ngay](https://chipstack.vn/san-pham/lcd-character-1602a-nen-xanh-duong/) |
| Module I2C LCD 1602 | [Mua ngay](https://chipstack.vn/san-pham/module-chuyen-doi-i2c-cho-lcd/) |
| DÃ¢y jumper Äá»±c â€“ Äá»±c | [Mua ngay](https://chipstack.vn/san-pham/day-jumper-duc-duc/) |
| DÃ¢y USB Type C |[Mua ngay](https://chipstack.vn/san-pham/day-usb-type-c-1m/) |
| Breadboard |[Mua ngay](https://chipstack.vn/san-pham/breadboard-830-lo/) |
| Cáº£m biáº¿n nhiá»‡t Ä‘á»™ DS18B20 | [Mua ngay](https://chipstack.vn/san-pham/cam-bien-nhiet-do-ds18b20/) |
| Äiá»‡n trá»Ÿ 4.7kÎ© | [Mua ngay](https://chipstack.vn/san-pham/dien-tro-1-4w-1/) |
| Äiá»‡n trá»Ÿ 120Î©| [Mua ngay](https://chipstack.vn/san-pham/dien-tro-1-4w-1/) |
| Module RTC DS3231 | [Mua ngay](https://chipstack.vn/san-pham/module-thoi-gian-thuc-ds3231/) |
| Module nguá»“n cho Breadboard MB102 830 | [Mua ngay](https://chipstack.vn/san-pham/module-nguon-cho-breadboard-mb102-830/) |
| Nguá»“n AC-DC Ä‘iá»u chá»‰nh Ä‘iá»‡n Ã¡p 3-12V 3A 36W | [Mua ngay](https://chipstack.vn/san-pham/nguon-ac-dc-dieu-chinh-dien-ap-3-12v-3a-36w/) |
| Module CAN MCP2551 | [Mua ngay](https://chipstack.vn/san-pham/module-can-mcp2551/) |

<div align="center">
    <img src="https://cdn.chipstack.vn/default/zerobase2-overview.png" alt="zerobase2">
    <p><em>Board Zerobase 2</em></p>
</div>

<div align="center">
    <img src="https://cdn.chipstack.vn/zerobase2/can/mcp2551.jpg" alt="mcp2551">
    <p><em>Module CAN MCP2551</em></p>
</div>

<div align="center">
    <img src="https://cdn.chipstack.vn/zerobase/rtc/rtc-ds3231.jpg" alt="button-lcd-rtc-ds3231">
    <p><em>Module RTC DS3231</em></p>
</div>

<div align="center">
    <img src="https://cdn.chipstack.vn/zerobase/lcd-module/lcd-i2c.png" alt="lcd-i2c">
    <p><em>LCD Character 1602A ná»n xanh dÆ°Æ¡ng</em></p>
</div>

<div align="center">
    <img src="https://cdn.chipstack.vn/zerobase/lcd-module/module-i2c.png" alt="module-i2c">
    <p><em>Module I2C LCD 1602</em></p>
</div>

<div align="center">
    <img src="https://cdn.chipstack.vn/default/breadboard.png" alt="breadboard">
    <p><em>Breadboard</em></p>
</div>

<div align="center">
    <img src="https://cdn.chipstack.vn/default/jumper-wire.png" alt="jumper-wire">
    <p><em>DÃ¢y ná»‘i</em></p>
</div>

<div align="center">
    <img src="https://cdn.chipstack.vn/default/usb-type-c.jpg" alt="button-lcd-usb-type-c">
    <p><em>DÃ¢y USB Type C</em></p>
</div>

<div align="center">
    <img src="https://cdn.chipstack.vn/zerobase2/ds18b20/ds18b20.png" alt="ds18b20">
    <p><em>Cáº£m biáº¿n nhiá»‡t Ä‘á»™ DS18B20</em></p>
</div>

<div align="center">
    <img src="https://cdn.chipstack.vn/default/dien-tro-4-7k-ohm.png" alt="dien-tro-330-ohm">
    <p><em>Äiá»‡n trá»Ÿ 4.7kÎ©</em></p>
</div>

<div align="center">
    <img src="https://cdn.chipstack.vn/default/dien-tro-120-ohm.png" alt="dien-tro-120-ohm">
    <p><em>Äiá»‡n trá»Ÿ 120Î©</em></p>
</div>

<div align="center">
    <img src="https://cdn.chipstack.vn/default/module-nguon-cho-breadboard-mb102-830.jpg" alt="module-nguon-cho-breadboard-mb102-830">
    <p><em>Module nguá»“n cho Breadboard MB102 830</em></p>
</div>

<div align="center">
    <img src="https://cdn.chipstack.vn/default/nguon-ac-dc-dieu-chinh-dien-ap-3-12v-3a-36w.jpg" alt="nguon-ac-dc-dieu-chinh-dien-ap-3-12v-3a-36w">
    <p><em>Nguá»“n AC-DC Ä‘iá»u chá»‰nh Ä‘iá»‡n Ã¡p 3-12V 3A 36W</em></p>
</div>

## NguyÃªn lÃ½ hoáº¡t Ä‘á»™ng

?> BÃ i hÆ°á»›ng dáº«n nÃ y sá»­ dá»¥ng 3 board Zerobase 2 Ä‘á»ƒ giao tiáº¿p CAN Bus vá»›i nhau.

?> 1 Board sáº½ sá»­ dá»¥ng Ä‘á»ƒ Ä‘á»c nhiá»‡t Ä‘á»™ tá»« cáº£m biáº¿n DS18B20.

?> 1 Board sáº½ sá»­ dá»¥ng Ä‘á»ƒ Ä‘á»c thá»i gian tá»« module RTC DS3231.

?> Sau Ä‘Ã³ Board cÃ²n láº¡i sáº½ yÃªu cáº§u 2 Board trÃªn gá»­i dá»¯ liá»‡u vá» cho nÃ³ vÃ  sau khi nháº­n dá»¯ liá»‡u, board nÃ y sáº½ hiá»ƒn thá»‹ lÃªn LCD 1602A.

## SÆ¡ Ä‘á»“ káº¿t ná»‘i

<div align="center">
    <img src="https://cdn.chipstack.vn/zerobase2/can/ds18b20-zerobase2-pins.png">
    <p><em>ChÃ¢n káº¿t ná»‘i cá»§a Zerobase thá»© nháº¥t</em></p>
</div>

<div align="center">
    <img src="https://cdn.chipstack.vn/zerobase2/can/ds3231-zerobase2-pins.png">
    <p><em>ChÃ¢n káº¿t ná»‘i cá»§a Zerobase thá»© hai</em></p>
</div>

<div align="center">
    <img src="https://cdn.chipstack.vn/zerobase2/can/lcd-zerobase2-pins.png">
    <p><em>ChÃ¢n káº¿t ná»‘i cá»§a Zerobase thá»© ba</em></p>
</div>

!> LÆ°u Ã½ quan trá»ng
* Pháº£i cáº¥p nguá»“n 5V cho module CAN MCP2551, náº¿u khÃ´ng module sáº½ khÃ´ng hoáº¡t Ä‘á»™ng
* Cáº§n káº¿t ná»‘i chÃ¢n GND cá»§a táº¥t cáº£ cÃ¡c module vá»›i nhau Ä‘á»ƒ táº¡o Ä‘iá»ƒm tham chiáº¿u chung

### Nguá»“n cung cáº¥p
* **Nguá»“n 5V:** Module CAN MCP2551 vÃ  LCD 1602A
* **Nguá»“n 3.3V:** Board Zerobase 2, module RTC DS3231 vÃ  cáº£m biáº¿n DS18B20

### SÆ¡ Ä‘á»“ káº¿t ná»‘i chi tiáº¿t

#### 1. Cáº£m biáº¿n nhiá»‡t Ä‘á»™ DS18B20 vá»›i Zerobase 2 thá»© nháº¥t
![ds18b20-pinout](https://cdn.chipstack.vn/zerobase2/ds18b20/pinout-ds18b20.jpg)

| Cáº£m biáº¿n DS18B20 | Zerobase 2 #1 | LÆ°u Ã½ |
|-----------------|---------------|-------|
| DQ | A0 | Cáº§n thÃªm Ä‘iá»‡n trá»Ÿ pull-up |
| VCC | 3.3V | |
| GND | GND | |

* **Äiá»‡n trá»Ÿ pull-up:** Káº¿t ná»‘i Ä‘iá»‡n trá»Ÿ 4.7kÎ© giá»¯a chÃ¢n DQ vÃ  VCC

#### 2. Module RTC DS3231 vá»›i Zerobase 2 thá»© hai

<div align="center">
    <img src="https://cdn.chipstack.vn/default/ds3231-pinout.png" alt="module-i2c">
</div>

| Module RTC DS3231 | Zerobase 2 #2 |
|------------------|---------------|
| SDA | SDA |
| SCL | SCL |
| VCC | 3.3V |
| GND | GND |

#### 3. LCD 1602A (qua I2C) vá»›i Zerobase 2 thá»© ba

<div align="center">
    <img src="https://cdn.chipstack.vn/zerobase/lcd-module/module-i2c.png" alt="module-i2c">
</div>

| Module I2C LCD 1602A | Zerobase 2 #3 |
|---------------------|---------------|
| SDA | SDA |
| SCL | SCL |
| VCC | 5V |
| GND | GND |

#### 4. Module CAN MCP2551 vá»›i má»—i Zerobase 2

<div align="center">
    <img src="https://cdn.chipstack.vn/zerobase2/can/mcp2551.jpg" alt="mcp2551">
</div>

| Module CAN MCP2551 | Zerobase 2 |
|-------------------|-----------|
| CTX | CTX |
| CRX | CRX |
| VCC | 5V |
| GND | GND |

#### Káº¾T Ná»I Máº NG CAN BUS
* Káº¿t ná»‘i táº¥t cáº£ cÃ¡c module CAN MCP2551 vá»›i nhau theo chuáº©n máº¡ng CAN:
  * Ná»‘i cÃ¡c chÃ¢n CANH cá»§a cÃ¡c module vá»›i nhau
  * Ná»‘i cÃ¡c chÃ¢n CANL cá»§a cÃ¡c module vá»›i nhau
  * **Vá» Ä‘iá»‡n trá»Ÿ Ä‘áº§u cuá»‘i:**
    * Láº¯p 1 Ä‘iá»‡n trá»Ÿ 120Î© giá»¯a chÃ¢n CANH vÃ  CANL táº¡i module CAN Ä‘áº§u tiÃªn trong máº¡ng
    * Láº¯p 1 Ä‘iá»‡n trá»Ÿ 120Î© giá»¯a chÃ¢n CANH vÃ  CANL táº¡i module CAN cuá»‘i cÃ¹ng trong máº¡ng
    * Hai Ä‘iá»‡n trá»Ÿ 120Î© nÃ y Ä‘Ã³ng vai trÃ² lÃ  Ä‘iá»‡n trá»Ÿ Ä‘áº§u cuá»‘i (termination resistors) giÃºp ngÄƒn pháº£n xáº¡ tÃ­n hiá»‡u vÃ  Ä‘áº£m báº£o truyá»n dá»¯ liá»‡u á»•n Ä‘á»‹nh

![can-mcp2551-schematic](https://cdn.chipstack.vn/zerobase2/can/can-mcp2551-schematic.png) 

![can-mcp2551-circuit](https://cdn.chipstack.vn/zerobase2/can/can-mcp2551-circuit.jpg)

## Code

### Code cho Zerobase 2 thá»© nháº¥t (Ä‘á»c nhiá»‡t Ä‘á»™ tá»« cáº£m biáº¿n DS18B20)

```cpp
/**********************************
* CAN_Temperature.ino
* Temperature sensor node
**********************************/

#include <Arduino.h>            // ThÆ° viá»‡n cÆ¡ báº£n cá»§a Arduino
#include <ZBCan.h>              // ThÆ° viá»‡n giao tiáº¿p CAN trÃªn Zerobase
#include <OneWire.h>            // ThÆ° viá»‡n giao tiáº¿p vá»›i thiáº¿t bá»‹ OneWire
#include <DallasTemperature.h>  // ThÆ° viá»‡n Ä‘á»c nhiá»‡t Ä‘á»™ tá»« cáº£m biáº¿n DS18B20
#include <ZBPrint.h>            // ThÆ° viá»‡n in áº¥n cho Zerobase

#define ONE_WIRE_BUS A0         // Äá»‹nh nghÄ©a chÃ¢n A0 Ä‘á»ƒ káº¿t ná»‘i vá»›i cáº£m biáº¿n DS18B20

OneWire oneWire(ONE_WIRE_BUS);  // Khá»Ÿi táº¡o Ä‘á»‘i tÆ°á»£ng OneWire trÃªn chÃ¢n A0
DallasTemperature sensors(&oneWire); // Khá»Ÿi táº¡o Ä‘á»‘i tÆ°á»£ng cáº£m biáº¿n DS18B20 qua giao tiáº¿p OneWire

int lastTemperature = 0;        // Biáº¿n lÆ°u trá»¯ giÃ¡ trá»‹ nhiá»‡t Ä‘á»™ gáº§n nháº¥t Ä‘á»c Ä‘Æ°á»£c

volatile bool tempRequested = false; // Cá» Ä‘Ã¡nh dáº¥u cÃ³ yÃªu cáº§u Ä‘á»c nhiá»‡t Ä‘á»™ tá»« node khÃ¡c

void canMessageReceived() {     // HÃ m callback Ä‘Æ°á»£c gá»i khi nháº­n Ä‘Æ°á»£c tin nháº¯n CAN
 uint32_t rxId = ZBCan1.getRxId(); // Láº¥y ID cá»§a node gá»­i tin nháº¯n

 if (rxId == 0x7 && ZBCan1.isString()) { // Kiá»ƒm tra náº¿u tin nháº¯n tá»« node chÃ­nh (ID 0x7) vÃ  lÃ  dáº¡ng chuá»—i
   String message = ZBCan1.getLastStringMessage(); // Láº¥y ná»™i dung chuá»—i tin nháº¯n
   Serial.print("Message received: ");    // In ra Serial Ä‘á»ƒ debug
   Serial.println(message);               // In ná»™i dung tin nháº¯n

   if (message == "GET_TEMP") {          // Náº¿u tin nháº¯n yÃªu cáº§u nhiá»‡t Ä‘á»™
     tempRequested = true;               // Äáº·t cá» yÃªu cáº§u nhiá»‡t Ä‘á»™ thÃ nh true
   }
 }
}

void readTemperature() {                  // HÃ m Ä‘á»c nhiá»‡t Ä‘á»™ tá»« cáº£m biáº¿n
 sensors.requestTemperatures();          // YÃªu cáº§u cáº£m biáº¿n Ä‘o nhiá»‡t Ä‘á»™
 lastTemperature = sensors.getTempCByIndex(0); // Äá»c nhiá»‡t Ä‘á»™ tá»« cáº£m biáº¿n Ä‘áº§u tiÃªn (index 0), Ä‘Æ¡n vá»‹ Ä‘á»™ C

 if (lastTemperature == DEVICE_DISCONNECTED_C || lastTemperature < -50) { // Kiá»ƒm tra náº¿u Ä‘á»c lá»—i hoáº·c giÃ¡ trá»‹ báº¥t thÆ°á»ng
   lastTemperature = 1000;                 // GÃ¡n giÃ¡ trá»‹ máº·c Ä‘á»‹nh lÃ  1000Â°C
   Serial.println("Sensor error - using default temperature"); // ThÃ´ng bÃ¡o lá»—i cáº£m biáº¿n
 }
}

void setup() {                           // HÃ m thiáº¿t láº­p cháº¡y má»™t láº§n khi khá»Ÿi Ä‘á»™ng
 Serial.begin(115200);                  // Khá»Ÿi táº¡o giao tiáº¿p Serial vá»›i tá»‘c Ä‘á»™ 115200 baud
 Serial.println("Temperature Node Starting"); // In thÃ´ng bÃ¡o khá»Ÿi Ä‘á»™ng

 sensors.begin();                       // Khá»Ÿi táº¡o cáº£m biáº¿n nhiá»‡t Ä‘á»™

 readTemperature();                     // Äá»c nhiá»‡t Ä‘á»™ láº§n Ä‘áº§u

 ZBCan1.begin();                        // Khá»Ÿi táº¡o giao tiáº¿p CAN

 ZBCan1.setTxId(0x2);                   // Äáº·t ID cá»§a node nÃ y lÃ  0x2 khi gá»­i tin nháº¯n

 uint32_t acceptedIds[] = { 0x1, 0x7 }; // Node chÃ­nh cÃ³ 2 ID: ID 0x1 sáº½ gá»­i Ä‘áº¿n cáº£ node xá»­ lÃ½ nhiá»‡t Ä‘á»™ vÃ  node xá»­ lÃ½ thá»i gian, ID 0x7 chá»‰ gá»­i Ä‘áº¿n node xá»­ lÃ½ nhiá»‡t Ä‘á»™
 ZBCan1.configureMultipleFilters(acceptedIds, 2); // Cáº¥u hÃ¬nh bá»™ lá»c chá»‰ nháº­n tin nháº¯n tá»« cÃ¡c ID Ä‘Ã£ chá»n

 ZBCan1.onReceive(canMessageReceived);  // Thiáº¿t láº­p hÃ m callback Ä‘á»ƒ xá»­ lÃ½ khi cÃ³ tin nháº¯n CAN Ä‘áº¿n.

 Serial.println("Temperature Node Ready"); // In thÃ´ng bÃ¡o sáºµn sÃ ng
}

void loop() {                            // HÃ m vÃ²ng láº·p chÃ­nh, cháº¡y liÃªn tá»¥c
 readTemperature();                     // Äá»c nhiá»‡t Ä‘á»™ Ä‘á»‹nh ká»³
 Serial.print("Temperature: ");         // In thÃ´ng tin nhiá»‡t Ä‘á»™ ra Serial
 Serial.println(lastTemperature);       // In giÃ¡ trá»‹ nhiá»‡t Ä‘á»™

 if (tempRequested) {                   // Kiá»ƒm tra náº¿u cÃ³ yÃªu cáº§u gá»­i nhiá»‡t Ä‘á»™
   ZBCan1.send(lastTemperature);        // Gá»­i giÃ¡ trá»‹ nhiá»‡t Ä‘á»™ qua CAN
   Serial.println("Temperature sent");  // In thÃ´ng bÃ¡o Ä‘Ã£ gá»­i nhiá»‡t Ä‘á»™
   tempRequested = false;               // Äáº·t láº¡i cá» yÃªu cáº§u
 }

 delay(500);                            // Táº¡m dá»«ng 500ms Ä‘á»ƒ á»•n Ä‘á»‹nh
}
```

### Code cho Zerobase 2 thá»© hai (Ä‘á»c thá»i gian tá»« module RTC DS3231)

```cpp
/**********************************
* CAN_RTC.ino
* Real-time clock node with DS3231
**********************************/

#include <Arduino.h>            // ThÆ° viá»‡n cÆ¡ báº£n cá»§a Arduino
#include <ZBCan.h>              // ThÆ° viá»‡n giao tiáº¿p CAN trÃªn Zerobase
#include <Wire.h>               // ThÆ° viá»‡n giao tiáº¿p I2C
#include <DS3231.h>             // ThÆ° viá»‡n giao tiáº¿p vá»›i module RTC DS3231
#include <ZBPrint.h>            // ThÆ° viá»‡n in áº¥n cho Zerobase

DS3231 rtc;                     // Khá»Ÿi táº¡o Ä‘á»‘i tÆ°á»£ng RTC DS3231

bool timeIsSet = false;         // Biáº¿n Ä‘Ã¡nh dáº¥u thá»i gian Ä‘Ã£ Ä‘Æ°á»£c cÃ i Ä‘áº·t chÆ°a (chá»‰ cÃ i Ä‘áº·t má»™t láº§n)

char dateTimeStr[17];           // Buffer lÆ°u chuá»—i ngÃ y/giá»

bool timeRequested = false;     // Cá» Ä‘Ã¡nh dáº¥u cÃ³ yÃªu cáº§u Ä‘á»c thá»i gian tá»« node khÃ¡c

void canMessageReceived() {     // HÃ m callback Ä‘Æ°á»£c gá»i khi nháº­n Ä‘Æ°á»£c tin nháº¯n CAN
 uint32_t rxId = ZBCan1.getRxId(); // Láº¥y ID cá»§a node gá»­i tin nháº¯n

 if (rxId == 0x8 && ZBCan1.isString()) { // Kiá»ƒm tra náº¿u tin nháº¯n tá»« node chÃ­nh (ID 0x8) vÃ  lÃ  dáº¡ng chuá»—i
   String message = ZBCan1.getLastStringMessage(); // Láº¥y ná»™i dung chuá»—i tin nháº¯n
   Serial.print("Message received: ");    // In ra Serial Ä‘á»ƒ debug
   Serial.println(message);               // In ná»™i dung tin nháº¯n

   if (message == "GET_TIME") {          // Náº¿u tin nháº¯n yÃªu cáº§u thá»i gian
     timeRequested = true;               // Äáº·t cá» yÃªu cáº§u thá»i gian thÃ nh true
   }
 }
}

void readDateTime() {           // HÃ m Ä‘á»c ngÃ y giá» hiá»‡n táº¡i tá»« RTC
 bool h12, PM, century;        // CÃ¡c biáº¿n cáº§n thiáº¿t cho cÃ¡c hÃ m Ä‘á»c RTC

 // Äá»c cÃ¡c thÃ nh pháº§n thá»i gian
 byte month = rtc.getMonth(century);    // Äá»c thÃ¡ng
 byte day = rtc.getDate();              // Äá»c ngÃ y
 byte year = rtc.getYear();             // Äá»c nÄƒm
 byte hour = rtc.getHour(h12, PM);      // Äá»c giá»
 byte minute = rtc.getMinute();         // Äá»c phÃºt
 byte second = rtc.getSecond();         // Äá»c giÃ¢y

 // Äá»‹nh dáº¡ng chuá»—i ngÃ y/giá»: DD/MM/YY HH:MM:SS
 sprintf(dateTimeStr, "%d/%d/%02d %02d:%02d:%02d",
         day, month, year, hour, minute, second);
}

void setup() {                  // HÃ m thiáº¿t láº­p cháº¡y má»™t láº§n khi khá»Ÿi Ä‘á»™ng
 Serial.begin(115200);         // Khá»Ÿi táº¡o giao tiáº¿p Serial vá»›i tá»‘c Ä‘á»™ 115200 baud
 Serial.println("RTC Node Starting"); // In thÃ´ng bÃ¡o khá»Ÿi Ä‘á»™ng

 Wire.begin();                 // Khá»Ÿi táº¡o giao tiáº¿p I2C cho RTC

 if (!timeIsSet) {             // Náº¿u thá»i gian chÆ°a Ä‘Æ°á»£c Ä‘áº·t
   // CÃ i Ä‘áº·t thá»i gian ban Ä‘áº§u (chá»‰ cáº§n lÃ m má»™t láº§n)
   // 5 thÃ¡ng 5, 2026, Thá»© 2, 17:00:00
   rtc.setYear(26);            // Äáº·t nÄƒm: 2026 (chá»‰ 2 sá»‘ cuá»‘i)
   rtc.setMonth(5);            // Äáº·t thÃ¡ng: thÃ¡ng 5
   rtc.setDate(5);             // Äáº·t ngÃ y: ngÃ y 5
   rtc.setDoW(2);              // Äáº·t thá»©: thá»© 2
   rtc.setHour(17);            // Äáº·t giá»: 17 giá»
   rtc.setMinute(0);           // Äáº·t phÃºt: 0 phÃºt
   rtc.setSecond(0);           // Äáº·t giÃ¢y: 0 giÃ¢y

   rtc.setClockMode(false);    // Äáº·t cháº¿ Ä‘á»™ 24 giá» (false = 24h, true = 12h)

   timeIsSet = true;           // ÄÃ¡nh dáº¥u Ä‘Ã£ cÃ i Ä‘áº·t thá»i gian
   Serial.println("Time set successfully"); // ThÃ´ng bÃ¡o cÃ i Ä‘áº·t thÃ nh cÃ´ng
 }

 readDateTime();               // Äá»c thá»i gian láº§n Ä‘áº§u

 ZBCan1.begin();               // Khá»Ÿi táº¡o giao tiáº¿p CAN

 ZBCan1.setTxId(0x3);          // Äáº·t ID cá»§a node nÃ y lÃ  0x3 khi gá»­i tin nháº¯n

 uint32_t acceptedIds[] = { 0x1, 0x8 }; // Node chÃ­nh cÃ³ 2 ID: ID 0x1 sáº½ gá»­i Ä‘áº¿n cáº£ node nhiá»‡t Ä‘á»™ vÃ  node thá»i gian, ID 0x8 chá»‰ gá»­i Ä‘áº¿n node thá»i gian
 ZBCan1.configureMultipleFilters(acceptedIds, 2); // Cáº¥u hÃ¬nh bá»™ lá»c chá»‰ nháº­n tin nháº¯n tá»« cÃ¡c ID Ä‘Ã£ chá»n

 ZBCan1.onReceive(canMessageReceived); //Thiáº¿t láº­p hÃ m callback Ä‘á»ƒ xá»­ lÃ½ khi cÃ³ tin nháº¯n CAN Ä‘áº¿n.

 Serial.println("RTC Node Ready"); // In thÃ´ng bÃ¡o sáºµn sÃ ng
}

void loop() {                   // HÃ m vÃ²ng láº·p chÃ­nh, cháº¡y liÃªn tá»¥c
 readDateTime();               // Äá»c thá»i gian hiá»‡n táº¡i

 if (timeRequested) {          // Náº¿u cÃ³ yÃªu cáº§u thá»i gian
   ZBCan1.send(dateTimeStr);   // Gá»­i chuá»—i thá»i gian qua CAN
   Serial.print("Time sent: ");// In thÃ´ng bÃ¡o Ä‘Ã£ gá»­i thá»i gian
   Serial.println(dateTimeStr);// In chuá»—i thá»i gian Ä‘Ã£ gá»­i
   timeRequested = false;      // Äáº·t láº¡i cá» yÃªu cáº§u
 }

 delay(1000);                  // Táº¡m dá»«ng 1000ms Ä‘á»ƒ á»•n Ä‘á»‹nh
}
```

### Code cho Zerobase 2 thá»© ba (hiá»ƒn thá»‹ nhiá»‡t Ä‘á»™ vÃ  thá»i gian lÃªn LCD 1602A)

```cpp
/**********************************
* CAN_Display.ino
* Display node with LCD I2C
**********************************/

#include <Arduino.h>            // ThÆ° viá»‡n cÆ¡ báº£n cá»§a Arduino
#include <ZBCan.h>              // ThÆ° viá»‡n giao tiáº¿p CAN trÃªn Zerobase
#include <Wire.h>               // ThÆ° viá»‡n giao tiáº¿p I2C
#include <LiquidCrystal_I2C.h>  // ThÆ° viá»‡n Ä‘iá»u khiá»ƒn LCD qua I2C
#include <ZBPrint.h>            // ThÆ° viá»‡n in áº¥n cho Zerobase

LiquidCrystal_I2C lcd(0x27, 16, 2); // Táº¡o Ä‘á»‘i tÆ°á»£ng LCD (Ä‘á»‹a chá»‰ 0x27, 16 cá»™t, 2 dÃ²ng)

int temperature = 0;            // Biáº¿n lÆ°u giÃ¡ trá»‹ nhiá»‡t Ä‘á»™ nháº­n Ä‘Æ°á»£c
char dateTime[17] = "00/00/00 00:00"; // Biáº¿n lÆ°u chuá»—i ngÃ y giá», Ä‘á»‹nh dáº¡ng: MM/DD/YY HH:MM

void canMessageReceived() {     // HÃ m callback Ä‘Æ°á»£c gá»i khi nháº­n Ä‘Æ°á»£c tin nháº¯n CAN
 uint32_t rxId = ZBCan1.getRxId(); // Láº¥y ID cá»§a node Ä‘Ã£ gá»­i tin nháº¯n

 if (rxId == 0x2) {            // Náº¿u tin nháº¯n tá»« node nhiá»‡t Ä‘á»™ (ID 0x2)
   if (ZBCan1.isInt()) {       // Kiá»ƒm tra náº¿u tin nháº¯n lÃ  kiá»ƒu sá»‘ nguyÃªn
     temperature = ZBCan1.getLastIntValue(); // Láº¥y giÃ¡ trá»‹ nhiá»‡t Ä‘á»™
     Serial.print("Temperature received: "); // In thÃ´ng bÃ¡o nháº­n nhiá»‡t Ä‘á»™
     Serial.print(temperature);         // In giÃ¡ trá»‹ nhiá»‡t Ä‘á»™
     Serial.println("Â°C");              // In Ä‘Æ¡n vá»‹ Ä‘á»™ C
   }
 } else if (rxId == 0x3) {     // Náº¿u tin nháº¯n tá»« node thá»i gian (ID 0x3)
   if (ZBCan1.isString()) {    // Kiá»ƒm tra náº¿u tin nháº¯n lÃ  kiá»ƒu chuá»—i
     strcpy(dateTime, ZBCan1.getLastStringMessage()); // Sao chÃ©p chuá»—i thá»i gian nháº­n Ä‘Æ°á»£c
     Serial.print("DateTime received: "); // In thÃ´ng bÃ¡o nháº­n thá»i gian
     Serial.println(dateTime);         // In chuá»—i thá»i gian
   }
 }
}

void updateDisplay() {          // HÃ m cáº­p nháº­t mÃ n hÃ¬nh LCD
 lcd.clear();                  // XÃ³a mÃ n hÃ¬nh LCD

 lcd.setCursor(0, 0);          // Äáº·t vá»‹ trÃ­ con trá» (dÃ²ng 1, cá»™t 1)
 lcd.print(dateTime);          // Hiá»ƒn thá»‹ ngÃ y giá» á»Ÿ dÃ²ng 1

 lcd.setCursor(3, 1);          // Äáº·t vá»‹ trÃ­ con trá» (dÃ²ng 2, cá»™t 4)
 lcd.print("Temp: ");          // Hiá»ƒn thá»‹ chá»¯ "Temp: "
 lcd.print(temperature);       // Hiá»ƒn thá»‹ giÃ¡ trá»‹ nhiá»‡t Ä‘á»™
 lcd.print(" C");              // Hiá»ƒn thá»‹ Ä‘Æ¡n vá»‹ Ä‘á»™ C
}

void setup() {                  // HÃ m thiáº¿t láº­p cháº¡y má»™t láº§n khi khá»Ÿi Ä‘á»™ng
 Serial.begin(115200);         // Khá»Ÿi táº¡o giao tiáº¿p Serial vá»›i tá»‘c Ä‘á»™ 115200 baud
 Serial.println("Display Node Starting"); // In thÃ´ng bÃ¡o khá»Ÿi Ä‘á»™ng

 Wire.begin();                 // Khá»Ÿi táº¡o giao tiáº¿p I2C
 lcd.begin(16, 2);             // Khá»Ÿi táº¡o LCD 16x2
 lcd.backlight();              // Báº­t Ä‘Ã¨n ná»n LCD
 lcd.clear();                  // XÃ³a mÃ n hÃ¬nh LCD
 lcd.print("Initializing..."); // Hiá»ƒn thá»‹ thÃ´ng bÃ¡o Ä‘ang khá»Ÿi táº¡o

 ZBCan1.begin();               // Khá»Ÿi táº¡o giao tiáº¿p CAN

 ZBCan1.setTxId(0x1);          // Äáº·t ID cá»§a node nÃ y lÃ  0x1 khi gá»­i tin nháº¯n

 uint32_t acceptedIds[] = { 0x2, 0x3 }; // Chá»‰ nháº­n tin nháº¯n tá»« node nhiá»‡t Ä‘á»™ (ID 0x2) vÃ  node thá»i gian (ID 0x3)
 ZBCan1.configureMultipleFilters(acceptedIds, 2); // Cáº¥u hÃ¬nh bá»™ lá»c

 ZBCan1.onReceive(canMessageReceived); // Thiáº¿t láº­p hÃ m callback Ä‘á»ƒ xá»­ lÃ½ khi cÃ³ tin nháº¯n CAN Ä‘áº¿n.

}

void loop() {                   // HÃ m vÃ²ng láº·p chÃ­nh, cháº¡y liÃªn tá»¥c
 ZBCan1.send("GET_TIME", 0x8); // Gá»­i tin nháº¯n "GET_TIME" vÃ  Ä‘áº·t ID tin nháº¯n thÃ nh 0x8 Ä‘á»ƒ node thá»i gian nháº­n biáº¿t
 Serial.println("Requesting time update"); // In thÃ´ng bÃ¡o yÃªu cáº§u cáº­p nháº­t thá»i gian

 ZBCan1.send("GET_TEMP", 0x7); // Gá»­i tin nháº¯n "GET_TEMP" vÃ  Ä‘áº·t ID tin nháº¯n thÃ nh 0x7 Ä‘á»ƒ node nhiá»‡t Ä‘á»™ nháº­n biáº¿t
 Serial.println("Requesting temperature update"); // In thÃ´ng bÃ¡o yÃªu cáº§u cáº­p nháº­t nhiá»‡t Ä‘á»™

 updateDisplay();              // Cáº­p nháº­t mÃ n hÃ¬nh LCD

 delay(1000);                  // Táº¡m dá»«ng 1000ms Ä‘á»ƒ á»•n Ä‘á»‹nh
}
```

Copy 3 Ä‘oáº¡n code trÃªn vÃ  dÃ¡n vÃ o Arduino IDE, káº¿t quáº£ sáº½ Ä‘Æ°á»£c nhÆ° hÃ¬nh bÃªn dÆ°á»›i.

![can-mcp2551-code](https://cdn.chipstack.vn/zerobase2/can/can-mcp2551-code.png)

### BiÃªn dá»‹ch

Nháº¥n vÃ o biá»ƒu tÆ°á»£ng Verify Ä‘á»ƒ biÃªn dá»‹ch code.

![verify-code](https://cdn.chipstack.vn/default/verify-code.png)

### Thá»±c hiá»‡n náº¡p code

Cuá»‘i cÃ¹ng báº¡n thá»±c hiá»‡n náº¡p code vÃ o board Zerobase 2. Náº¿u chÆ°a biáº¿t cÃ¡ch náº¡p code cho Zerobase 2, báº¡n cÃ³ thá»ƒ tham kháº£o [táº¡i Ä‘Ã¢y](https://zerobase.chipstack.vn/#/vi/zerobase-2/quickstart).

### SÆ¡ lÆ°á»£c vá» thÆ° viá»‡n ZBCan

#### Báº£ng thÃ´ng tin háº±ng sá»‘ CAN Mode

| Cháº¿ Ä‘á»™ | MÃ´ táº£ |
|--------|-------|
| ZBCAN_MODE_NORMAL | Cháº¿ Ä‘á»™ hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng |
| ZBCAN_MODE_LOOPBACK | Cháº¿ Ä‘á»™ kiá»ƒm tra vÃ²ng láº·p (tá»± gá»­i nháº­n) |
| ZBCAN_MODE_SILENT | Cháº¿ Ä‘á»™ im láº·ng (chá»‰ nghe) |
| ZBCAN_MODE_SILENT_LOOPBACK | Káº¿t há»£p cháº¿ Ä‘á»™ im láº·ng vÃ  vÃ²ng láº·p |

#### Báº£ng thÃ´ng tin Ä‘á»‹nh dáº¡ng khung

| Äá»‹nh dáº¡ng | MÃ´ táº£ |
|-----------|-------|
| ZBCAN_STANDARD_FRAME | Khung chuáº©n (ID 11-bit) |
| ZBCAN_EXTENDED_FRAME | Khung má»Ÿ rá»™ng (ID 29-bit) |

#### LÆ°u Ã½ khi sá»­ dá»¥ng ZBCan

1. Má»—i node trÃªn máº¡ng CAN cáº§n cÃ³ má»™t ID duy nháº¥t
2. Táº¥t cáº£ node pháº£i thiáº¿t láº­p cÃ¹ng má»™t tá»‘c Ä‘á»™ truyá»n (baudrate)

#### 1. Khá»Ÿi táº¡o giao tiáº¿p CAN

```cpp
bool begin();
bool begin(uint32_t baud, uint8_t mode = ZBCAN_MODE_NORMAL, 
           uint32_t txId = 0x100, uint8_t frameFormat = ZBCAN_STANDARD_FRAME);
```

- **Má»¥c Ä‘Ã­ch**: Khá»Ÿi táº¡o giao tiáº¿p CAN
- **Chi tiáº¿t**: 
  - PhiÃªn báº£n Ä‘Æ¡n giáº£n khÃ´ng cáº§n tham sá»‘, sá»­ dá»¥ng cáº¥u hÃ¬nh máº·c Ä‘á»‹nh (500kbps, cháº¿ Ä‘á»™ bÃ¬nh thÆ°á»ng)
  - PhiÃªn báº£n Ä‘áº§y Ä‘á»§ cho phÃ©p cáº¥u hÃ¬nh chi tiáº¿t
- **Tham sá»‘**:
  - `baud`: Tá»‘c Ä‘á»™ truyá»n (bit/giÃ¢y, vÃ­ dá»¥: 500000 cho 500kbps)
  - `mode`: Cháº¿ Ä‘á»™ hoáº¡t Ä‘á»™ng (ZBCAN_MODE_NORMAL, ZBCAN_MODE_LOOPBACK...)
  - `txId`: ID cá»§a node khi gá»­i tin nháº¯n
  - `frameFormat`: Äá»‹nh dáº¡ng khung (ZBCAN_STANDARD_FRAME hoáº·c ZBCAN_EXTENDED_FRAME)
- **GiÃ¡ trá»‹ tráº£ vá»**: `bool` - true náº¿u khá»Ÿi táº¡o thÃ nh cÃ´ng, false náº¿u tháº¥t báº¡i

#### 2. Cáº¥u hÃ¬nh tá»‘c Ä‘á»™ vÃ  cháº¿ Ä‘á»™

```cpp
bool setSpeed(uint32_t baud);
bool setMode(uint8_t mode);
```

- **Má»¥c Ä‘Ã­ch**: Thay Ä‘á»•i tá»‘c Ä‘á»™ truyá»n hoáº·c cháº¿ Ä‘á»™ hoáº¡t Ä‘á»™ng sau khi Ä‘Ã£ khá»Ÿi táº¡o
- **Chi tiáº¿t**:
  - `setSpeed`: Äáº·t tá»‘c Ä‘á»™ truyá»n má»›i cho CAN
  - `setMode`: Thay Ä‘á»•i cháº¿ Ä‘á»™ hoáº¡t Ä‘á»™ng cá»§a CAN
- **Tham sá»‘**:
  - `baud`: Tá»‘c Ä‘á»™ truyá»n (bit/giÃ¢y, vÃ­ dá»¥: 500000 cho 500kbps)
  - `mode`: Cháº¿ Ä‘á»™ hoáº¡t Ä‘á»™ng (ZBCAN_MODE_NORMAL, ZBCAN_MODE_LOOPBACK...)
- **GiÃ¡ trá»‹ tráº£ vá»**: `bool` - true náº¿u thÃ nh cÃ´ng, false náº¿u tháº¥t báº¡i
- **LÆ°u Ã½**: Cáº§n gá»i sau khi Ä‘Ã£ khá»Ÿi táº¡o CAN báº±ng hÃ m begin()

#### 3. Thiáº¿t láº­p ID vÃ  bá»™ lá»c

```cpp
void setTxId(uint32_t id);
bool configureMultipleFilters(uint32_t* ids, uint8_t count);
bool acceptAllIds();
```

- **Má»¥c Ä‘Ã­ch**: Cáº¥u hÃ¬nh ID gá»­i vÃ  bá»™ lá»c ID nháº­n
- **Chi tiáº¿t**:
  - `setTxId`: Äáº·t ID cho node khi gá»­i tin nháº¯n
  - `configureMultipleFilters`: Chá»‰ nháº­n tin nháº¯n tá»« danh sÃ¡ch ID cá»¥ thá»ƒ
  - `acceptAllIds`: Nháº­n táº¥t cáº£ tin nháº¯n trÃªn máº¡ng CAN khÃ´ng lá»c
- **Tham sá»‘**:
  - `id`: ID cá»§a node khi gá»­i tin nháº¯n
  - `ids`: Máº£ng cÃ¡c ID Ä‘Æ°á»£c cháº¥p nháº­n
  - `count`: Sá»‘ lÆ°á»£ng ID trong máº£ng
- **GiÃ¡ trá»‹ tráº£ vá»**: TÃ¹y thuá»™c vÃ o hÃ m

#### 4. Gá»­i tin nháº¯n

```cpp
uint8_t send(const char *message, uint32_t id = 0);
uint8_t send(int value, uint32_t id = 0);
uint8_t send(unsigned int value, uint32_t id = 0);
```

- **Má»¥c Ä‘Ã­ch**: Gá»­i tin nháº¯n qua máº¡ng CAN
- **Chi tiáº¿t**: Há»— trá»£ nhiá»u kiá»ƒu dá»¯ liá»‡u (chuá»—i, sá»‘ nguyÃªn, sá»‘ khÃ´ng dáº¥u...)
- **Tham sá»‘**:
  - `message`: Chuá»—i cáº§n gá»­i
  - `value`: GiÃ¡ trá»‹ sá»‘ cáº§n gá»­i
  - `id`: ID tÃ¹y chá»n (náº¿u khÃ¡c 0 sáº½ ghi Ä‘Ã¨ ID máº·c Ä‘á»‹nh Ä‘Ã£ Ä‘áº·t)
- **GiÃ¡ trá»‹ tráº£ vá»**: `uint8_t` - 0 náº¿u gá»­i thÃ nh cÃ´ng, 1 náº¿u tháº¥t báº¡i

#### 5. Thiáº¿t láº­p hÃ m callback Ä‘á»ƒ xá»­ lÃ½ khi cÃ³ tin nháº¯n CAN Ä‘áº¿n.

```cpp
void onReceive(ZBCanCallback callback);
void onString(ZBCanCallback callback);
void onInt(ZBCanCallback callback);
```

- **Má»¥c Ä‘Ã­ch**: Thiáº¿t láº­p hÃ m callback Ä‘á»ƒ xá»­ lÃ½ khi cÃ³ tin nháº¯n CAN Ä‘áº¿n.
- **Chi tiáº¿t**: 
  - `onReceive`: Gá»i khi nháº­n báº¥t ká»³ tin nháº¯n nÃ o
  - `onString`: Chá»‰ gá»i khi nháº­n tin nháº¯n dáº¡ng chuá»—i
  - `onInt`: Chá»‰ gá»i khi nháº­n tin nháº¯n dáº¡ng sá»‘ nguyÃªn
- **Tham sá»‘**:
  - `callback`: HÃ m Ä‘Æ°á»£c gá»i khi nháº­n tin nháº¯n
- **LÆ°u Ã½**: Callback khÃ´ng cÃ³ tham sá»‘, pháº£i sá»­ dá»¥ng cÃ¡c getter Ä‘á»ƒ láº¥y dá»¯ liá»‡u

#### 6. Kiá»ƒm tra kiá»ƒu tin nháº¯n

```cpp
bool isString();
bool isInt();
bool isUint();
```

- **Má»¥c Ä‘Ã­ch**: Kiá»ƒm tra kiá»ƒu cá»§a tin nháº¯n vá»«a nháº­n
- **Chi tiáº¿t**: XÃ¡c Ä‘á»‹nh kiá»ƒu dá»¯ liá»‡u cá»§a tin nháº¯n cuá»‘i cÃ¹ng Ä‘Æ°á»£c nháº­n
- **GiÃ¡ trá»‹ tráº£ vá»**: `bool` - true náº¿u tin nháº¯n cÃ³ kiá»ƒu tÆ°Æ¡ng á»©ng

#### 7. Láº¥y dá»¯ liá»‡u tá»« tin nháº¯n Ä‘Ã£ nháº­n

```cpp
const char* getLastStringMessage();
int32_t getLastIntValue();
uint32_t getLastUintValue();
uint32_t getRxId();
```

- **Má»¥c Ä‘Ã­ch**: Láº¥y dá»¯ liá»‡u tá»« tin nháº¯n Ä‘Ã£ nháº­n
- **Chi tiáº¿t**:
  - `getLastStringMessage`: Láº¥y ná»™i dung chuá»—i tá»« tin nháº¯n cuá»‘i
  - `getLastIntValue`: Láº¥y giÃ¡ trá»‹ sá»‘ nguyÃªn tá»« tin nháº¯n cuá»‘i
  - `getLastUintValue`: Láº¥y giÃ¡ trá»‹ sá»‘ khÃ´ng dáº¥u tá»« tin nháº¯n cuá»‘i
  - `getRxId`: Láº¥y ID cá»§a node Ä‘Ã£ gá»­i tin nháº¯n cuá»‘i
- **GiÃ¡ trá»‹ tráº£ vá»**: TÃ¹y thuá»™c vÃ o kiá»ƒu dá»¯ liá»‡u

### Giáº£i thÃ­ch code

Há»‡ thá»‘ng gá»“m 3 node Zerobase 2 giao tiáº¿p qua máº¡ng CAN Ä‘á»ƒ hiá»ƒn thá»‹ nhiá»‡t Ä‘á»™ vÃ  thá»i gian. Má»—i node cÃ³ ID vÃ  vai trÃ² riÃªng trong máº¡ng.

#### 1. Node chÃ­nh (Zerobase 2 thá»© ba) - Hiá»ƒn thá»‹ dá»¯ liá»‡u

Node chÃ­nh Ä‘iá»u khiá»ƒn há»‡ thá»‘ng, gá»­i yÃªu cáº§u vÃ  hiá»ƒn thá»‹ dá»¯ liá»‡u lÃªn mÃ n hÃ¬nh LCD.

##### Thiáº¿t láº­p ban Ä‘áº§u (hÃ m setup)

```cpp
void setup() {
 Serial.begin(115200);         // Khá»Ÿi táº¡o Serial
 Serial.println("Display Node Starting");

 Wire.begin();                 // Khá»Ÿi táº¡o I2C
 lcd.begin(16, 2);             // Khá»Ÿi táº¡o LCD 16x2
 lcd.backlight();              // Báº­t Ä‘Ã¨n ná»n LCD
 lcd.clear();                  // XÃ³a mÃ n hÃ¬nh
 // Hiá»ƒn thá»‹ thÃ´ng Ä‘iá»‡p khá»Ÿi Ä‘á»™ng
  lcd.setCursor(2, 0);       // Cá»™t 2, dÃ²ng 0
  lcd.print("Zerobase 2!!!");  // DÃ²ng chá»¯ Ä‘áº§u
  lcd.setCursor(2, 1);       // Cá»™t 2, dÃ²ng 1
  lcd.print("Starting...");  // DÃ²ng chá»¯ thá»© hai
  delay(2000);               // Dá»«ng láº¡i 2 giÃ¢y Ä‘á»ƒ ngÆ°á»i dÃ¹ng Ä‘á»c

  lcd.clear();  // XÃ³a mÃ n hÃ¬nh sau khi hiá»ƒn thá»‹

 ZBCan1.begin();               // Khá»Ÿi táº¡o CAN
 ZBCan1.setTxId(0x1);          // Äáº·t ID gá»­i tin nháº¯n lÃ  0x1

 uint32_t acceptedIds[] = { 0x2, 0x3 }; // Chá»‰ nháº­n tin nháº¯n tá»« node nhiá»‡t Ä‘á»™ vÃ  thá»i gian
 ZBCan1.configureMultipleFilters(acceptedIds, 2);

 ZBCan1.onReceive(canMessageReceived); // ÄÄƒng kÃ½ hÃ m callback
}
```

- `Serial.begin(115200)`: Khá»Ÿi táº¡o giao tiáº¿p Serial vá»›i tá»‘c Ä‘á»™ 115200 bits/giÃ¢y Ä‘á»ƒ gá»­i thÃ´ng tin debug ra mÃ¡y tÃ­nh
- `Wire.begin()`: Khá»Ÿi táº¡o giao thá»©c I2C, cáº§n thiáº¿t cho giao tiáº¿p vá»›i LCD 1602A
- `lcd.begin(16, 2)`: Khá»Ÿi táº¡o mÃ n hÃ¬nh LCD vá»›i 16 cá»™t vÃ  2 dÃ²ng
- `lcd.backlight()`: Báº­t Ä‘Ã¨n ná»n mÃ n hÃ¬nh LCD, giÃºp Ä‘á»c Ä‘Æ°á»£c ná»™i dung trong Ä‘iá»u kiá»‡n thiáº¿u Ã¡nh sÃ¡ng
- `lcd.clear()`: XÃ³a toÃ n bá»™ ná»™i dung hiá»ƒn thá»‹ trÃªn mÃ n hÃ¬nh LCD
- `lcd.print("Initializing...")`: Hiá»ƒn thá»‹ thÃ´ng bÃ¡o Ä‘ang khá»Ÿi táº¡o trÃªn mÃ n hÃ¬nh
- `ZBCan1.begin()`: Khá»Ÿi táº¡o giao tiáº¿p CAN vá»›i cÃ¡c thiáº¿t láº­p máº·c Ä‘á»‹nh (500kbps)
- `ZBCan1.setTxId(0x1)`: Äáº·t ID gá»­i tin nháº¯n cá»§a node lÃ  0x1
- `ZBCan1.configureMultipleFilters(acceptedIds, 2)`: Cáº¥u hÃ¬nh bá»™ lá»c Ä‘á»ƒ chá»‰ nháº­n tin nháº¯n tá»« node cÃ³ ID 0x2 (nhiá»‡t Ä‘á»™) vÃ  0x3 (thá»i gian)
- `ZBCan1.onReceive(canMessageReceived)`: ÄÄƒng kÃ½ hÃ m callback Ä‘Æ°á»£c gá»i má»—i khi nháº­n Ä‘Æ°á»£c tin nháº¯n CAN

##### Gá»­i tin nháº¯n (trong vÃ²ng láº·p loop)

```cpp
void loop() {
 ZBCan1.send("GET_TIME", 0x8); // Gá»­i tin nháº¯n "GET_TIME" vá»›i ID 0x8 Ä‘áº¿n node thá»i gian
 Serial.println("Requesting time update");

 ZBCan1.send("GET_TEMP", 0x7); // Gá»­i tin nháº¯n "GET_TEMP" vá»›i ID 0x7 Ä‘áº¿n node nhiá»‡t Ä‘á»™
 Serial.println("Requesting temperature update");

 updateDisplay();              // Cáº­p nháº­t mÃ n hÃ¬nh LCD
 delay(1000);                  // Táº¡m dá»«ng 1 giÃ¢y
}
```

- `ZBCan1.send("GET_TIME", 0x8)`: Gá»­i chuá»—i "GET_TIME" qua máº¡ng CAN vá»›i ID gá»­i lÃ  0x8
  - Tham sá»‘ Ä‘áº§u tiÃªn: Dá»¯ liá»‡u cáº§n gá»­i (chuá»—i "GET_TIME")
  - Tham sá»‘ thá»© hai: ID cá»§a tin nháº¯n (0x8), node thá»i gian Ä‘Æ°á»£c cáº¥u hÃ¬nh Ä‘á»ƒ láº¯ng nghe ID nÃ y
- `ZBCan1.send("GET_TEMP", 0x7)`: TÆ°Æ¡ng tá»±, gá»­i chuá»—i "GET_TEMP" vá»›i ID 0x7 Ä‘á»ƒ node nhiá»‡t Ä‘á»™ nháº­n Ä‘Æ°á»£c
- `updateDisplay()`: Gá»i hÃ m cáº­p nháº­t hiá»ƒn thá»‹ lÃªn mÃ n hÃ¬nh LCD
- `delay(1000)`: Táº¡m dá»«ng chÆ°Æ¡ng trÃ¬nh 1000ms (1 giÃ¢y) trÆ°á»›c khi láº·p láº¡i vÃ²ng loop

<div align="center">
    <img src="https://cdn.chipstack.vn/zerobase2/can/can-mcp2551-main-node-send.png" alt="module-i2c">
        <p><em>Káº¿t quáº£ khi node chÃ­nh gá»­i tin nháº¯n Ä‘áº¿n node xá»­ lÃ½ nhiá»‡t Ä‘á»™ vÃ  node xá»­ lÃ½ thá»i gian</em></p>
</div>

##### Nháº­n tin nháº¯n (hÃ m callback)

```cpp
void canMessageReceived() {
 uint32_t rxId = ZBCan1.getRxId(); // Láº¥y ID cá»§a node gá»­i tin nháº¯n

 if (rxId == 0x2) {            // Náº¿u tin nháº¯n tá»« node nhiá»‡t Ä‘á»™ (ID 0x2)
   if (ZBCan1.isInt()) {       // Kiá»ƒm tra kiá»ƒu dá»¯ liá»‡u sá»‘ nguyÃªn
     temperature = ZBCan1.getLastIntValue(); // Láº¥y giÃ¡ trá»‹ nhiá»‡t Ä‘á»™
     Serial.print("Temperature received: ");
     Serial.print(temperature);
     Serial.println("Â°C");
   }
 } else if (rxId == 0x3) {     // Náº¿u tin nháº¯n tá»« node thá»i gian (ID 0x3)
   if (ZBCan1.isString()) {    // Kiá»ƒm tra kiá»ƒu dá»¯ liá»‡u chuá»—i
     strcpy(dateTime, ZBCan1.getLastStringMessage()); // Sao chÃ©p chuá»—i thá»i gian
     Serial.print("DateTime received: ");
     Serial.println(dateTime);
   }
 }
}
```

- `ZBCan1.getRxId()`: Láº¥y ID cá»§a node Ä‘Ã£ gá»­i tin nháº¯n hiá»‡n táº¡i
- `ZBCan1.isInt()`: Kiá»ƒm tra náº¿u tin nháº¯n nháº­n Ä‘Æ°á»£c cÃ³ kiá»ƒu dá»¯ liá»‡u sá»‘ nguyÃªn 
- `ZBCan1.getLastIntValue()`: Láº¥y giÃ¡ trá»‹ sá»‘ nguyÃªn tá»« tin nháº¯n vá»«a nháº­n
- `ZBCan1.isString()`: Kiá»ƒm tra náº¿u tin nháº¯n nháº­n Ä‘Æ°á»£c cÃ³ kiá»ƒu dá»¯ liá»‡u chuá»—i
- `strcpy(dateTime, ZBCan1.getLastStringMessage())`: Sao chÃ©p chuá»—i thá»i gian tá»« tin nháº¯n vÃ o biáº¿n `dateTime`
  - HÃ m `strcpy` lÃ  hÃ m chuáº©n cá»§a ngÃ´n ngá»¯ C, sao chÃ©p toÃ n bá»™ ná»™i dung tá»« chuá»—i nguá»“n sang chuá»—i Ä‘Ã­ch
  - Tham sá»‘ thá»© nháº¥t: Chuá»—i Ä‘Ã­ch (biáº¿n `dateTime` Ä‘á»ƒ lÆ°u káº¿t quáº£)
  - Tham sá»‘ thá»© hai: Chuá»—i nguá»“n (dá»¯ liá»‡u tá»« tin nháº¯n CAN)

<div align="center">
    <img src="https://cdn.chipstack.vn/zerobase2/can/can-mcp2551-main-node-receive.png" alt="module-i2c">
        <p><em>Káº¿t quáº£ khi node chÃ­nh nháº­n Ä‘Æ°á»£c tin nháº¯n tráº£ vá» tá»« node xá»­ lÃ½ nhiá»‡t Ä‘á»™ vÃ  node xá»­ lÃ½ thá»i gian</em></p>
</div>

##### Hiá»ƒn thá»‹ dá»¯ liá»‡u (hÃ m updateDisplay)

```cpp
void updateDisplay() {
 lcd.clear();                  // XÃ³a mÃ n hÃ¬nh LCD

 lcd.setCursor(0, 0);          // Äáº·t vá»‹ trÃ­ con trá» (dÃ²ng 1, cá»™t 1)
 lcd.print(dateTime);          // Hiá»ƒn thá»‹ ngÃ y giá» á»Ÿ dÃ²ng 1

 lcd.setCursor(3, 1);          // Äáº·t vá»‹ trÃ­ con trá» (dÃ²ng 2, cá»™t 4)
 lcd.print("Temp: ");          // Hiá»ƒn thá»‹ chá»¯ "Temp: "
 lcd.print(temperature);       // Hiá»ƒn thá»‹ giÃ¡ trá»‹ nhiá»‡t Ä‘á»™
 lcd.print(" C");              // Hiá»ƒn thá»‹ Ä‘Æ¡n vá»‹ Ä‘á»™ C
}
```

- `lcd.clear()`: XÃ³a toÃ n bá»™ ná»™i dung trÃªn mÃ n hÃ¬nh LCD
- `lcd.setCursor(0, 0)`: Äáº·t vá»‹ trÃ­ con trá» LCD táº¡i cá»™t 0, dÃ²ng 0 (dÃ²ng Ä‘áº§u tiÃªn)
- `lcd.print(dateTime)`: Hiá»ƒn thá»‹ chuá»—i thá»i gian táº¡i vá»‹ trÃ­ con trá»
- `lcd.setCursor(3, 1)`: Äáº·t vá»‹ trÃ­ con trá» LCD táº¡i cá»™t 3, dÃ²ng 1 (dÃ²ng thá»© hai)
- `lcd.print("Temp: ")`: Hiá»ƒn thá»‹ chuá»—i "Temp: " táº¡i vá»‹ trÃ­ con trá»
- `lcd.print(temperature)`: Hiá»ƒn thá»‹ giÃ¡ trá»‹ nhiá»‡t Ä‘á»™, tá»± Ä‘á»™ng chuyá»ƒn Ä‘á»•i sá»‘ nguyÃªn thÃ nh chuá»—i
- `lcd.print(" C")`: Hiá»ƒn thá»‹ Ä‘Æ¡n vá»‹ Ä‘á»™ C sau giÃ¡ trá»‹ nhiá»‡t Ä‘á»™

#### 2. Node xá»­ lÃ½ nhiá»‡t Ä‘á»™ (Zerobase 2 thá»© nháº¥t)

Node nÃ y Ä‘á»c nhiá»‡t Ä‘á»™ tá»« cáº£m biáº¿n DS18B20 vÃ  gá»­i vá» node chÃ­nh khi cÃ³ yÃªu cáº§u.

##### Thiáº¿t láº­p ban Ä‘áº§u (hÃ m setup)

```cpp
void setup() {
 Serial.begin(115200);                  // Khá»Ÿi táº¡o Serial
 Serial.println("Temperature Node Starting");

 sensors.begin();                       // Khá»Ÿi táº¡o cáº£m biáº¿n nhiá»‡t Ä‘á»™

 readTemperature();                     // Äá»c nhiá»‡t Ä‘á»™ láº§n Ä‘áº§u

 ZBCan1.begin();                        // Khá»Ÿi táº¡o CAN
 ZBCan1.setTxId(0x2);                   // Äáº·t ID gá»­i tin nháº¯n lÃ  0x2

 uint32_t acceptedIds[] = { 0x1, 0x7 }; // Chá»‰ nháº­n tin nháº¯n tá»« node chÃ­nh
 ZBCan1.configureMultipleFilters(acceptedIds, 2);

 ZBCan1.onReceive(canMessageReceived);  // ÄÄƒng kÃ½ hÃ m callback

 Serial.println("Temperature Node Ready");
}
```

- `sensors.begin()`: Khá»Ÿi táº¡o thÆ° viá»‡n DallasTemperature Ä‘á»ƒ giao tiáº¿p vá»›i cáº£m biáº¿n DS18B20
- `readTemperature()`: Gá»i hÃ m Ä‘á»c nhiá»‡t Ä‘á»™ láº§n Ä‘áº§u Ä‘á»ƒ kiá»ƒm tra cáº£m biáº¿n
- `ZBCan1.setTxId(0x2)`: Äáº·t ID gá»­i tin nháº¯n cá»§a node lÃ  0x2
- `ZBCan1.configureMultipleFilters(acceptedIds, 2)`: Cáº¥u hÃ¬nh bá»™ lá»c Ä‘á»ƒ chá»‰ nháº­n tin nháº¯n cÃ³ ID 0x1 (tá»« node chÃ­nh) vÃ  0x7 (yÃªu cáº§u nhiá»‡t Ä‘á»™)


##### Äá»c nhiá»‡t Ä‘á»™

```cpp
void readTemperature() {
 sensors.requestTemperatures();          // YÃªu cáº§u cáº£m biáº¿n Ä‘o nhiá»‡t Ä‘á»™
 lastTemperature = sensors.getTempCByIndex(0); // Äá»c nhiá»‡t Ä‘á»™, Ä‘Æ¡n vá»‹ Ä‘á»™ C

 if (lastTemperature == DEVICE_DISCONNECTED_C || lastTemperature < -50) { // Kiá»ƒm tra lá»—i
   lastTemperature = 1000;               // GÃ¡n giÃ¡ trá»‹ máº·c Ä‘á»‹nh náº¿u lá»—i
   Serial.println("Sensor error - using default temperature");
 }
}
```

- `sensors.requestTemperatures()`: YÃªu cáº§u táº¥t cáº£ cáº£m biáº¿n DS18B20 trÃªn bus OneWire thá»±c hiá»‡n Ä‘o nhiá»‡t Ä‘á»™
- `sensors.getTempCByIndex(0)`: Äá»c nhiá»‡t Ä‘á»™ tá»« cáº£m biáº¿n Ä‘áº§u tiÃªn (index 0) trÃªn bus, Ä‘Æ¡n vá»‹ Ä‘á»™ C
- `DEVICE_DISCONNECTED_C`: Háº±ng sá»‘ Ä‘áº·c biá»‡t (-127Â°C) tráº£ vá» khi khÃ´ng thá»ƒ Ä‘á»c Ä‘Æ°á»£c cáº£m biáº¿n
- `lastTemperature < -50`: Kiá»ƒm tra thÃªm giÃ¡ trá»‹ báº¥t thÆ°á»ng (nhiá»‡t Ä‘á»™ quÃ¡ tháº¥p)
- `lastTemperature = 1000`: Äáº·t giÃ¡ trá»‹ máº·c Ä‘á»‹nh lÃ  1000Â°C khi cÃ³ lá»—i

##### Nháº­n tin nháº¯n

```cpp
void canMessageReceived() {
 uint32_t rxId = ZBCan1.getRxId();

 if (rxId == 0x7 && ZBCan1.isString()) { // Kiá»ƒm tra tin nháº¯n tá»« node chÃ­nh vá»›i ID 0x7
   String message = ZBCan1.getLastStringMessage();
   Serial.print("Message received: ");
   Serial.println(message);

   if (message == "GET_TEMP") {          // Náº¿u tin nháº¯n yÃªu cáº§u nhiá»‡t Ä‘á»™
     tempRequested = true;               // Äáº·t cá» yÃªu cáº§u nhiá»‡t Ä‘á»™
   }
 }
}
```

- `String message = ZBCan1.getLastStringMessage()`: Láº¥y ná»™i dung chuá»—i tá»« tin nháº¯n CAN vá»«a nháº­n
  - HÃ m nÃ y tráº£ vá» con trá» char* tá»« bá»™ Ä‘á»‡m ná»™i bá»™ cá»§a thÆ° viá»‡n ZBCan
  - Chuyá»ƒn Ä‘á»•i thÃ nh Ä‘á»‘i tÆ°á»£ng String cá»§a Arduino Ä‘á»ƒ dá»… so sÃ¡nh
- `message == "GET_TEMP"`: So sÃ¡nh ná»™i dung tin nháº¯n vá»›i chuá»—i "GET_TEMP"
- `tempRequested = true`: Äáº·t cá» bÃ¡o hiá»‡u cÃ³ yÃªu cáº§u gá»­i nhiá»‡t Ä‘á»™

<div align="center">
    <img src="https://cdn.chipstack.vn/zerobase2/can/can-mcp2551-temperature-node-receive.png" alt="can-mcp2551-temperature-node-receive">
        <p><em>Káº¿t quáº£ khi node xá»­ lÃ½ nhiá»‡t Ä‘á»™ nháº­n Ä‘Æ°á»£c tin nháº¯n yÃªu cáº§u gá»­i nhiá»‡t Ä‘á»™ tá»« node chÃ­nh</em></p>
</div>

##### Gá»­i tin nháº¯n

```cpp
void loop() {
 readTemperature();                     // Äá»c nhiá»‡t Ä‘á»™ Ä‘á»‹nh ká»³
 Serial.print("Temperature: ");
 Serial.println(lastTemperature);

 if (tempRequested) {                   // Kiá»ƒm tra náº¿u cÃ³ yÃªu cáº§u gá»­i nhiá»‡t Ä‘á»™
   ZBCan1.send(lastTemperature);        // Gá»­i giÃ¡ trá»‹ nhiá»‡t Ä‘á»™ qua CAN
   Serial.println("Temperature sent");
   tempRequested = false;               // Äáº·t láº¡i cá» yÃªu cáº§u
 }

 delay(500);                            // Táº¡m dá»«ng 500ms
}
```

- `ZBCan1.send(lastTemperature)`: Gá»­i giÃ¡ trá»‹ nhiá»‡t Ä‘á»™ (kiá»ƒu sá»‘ nguyÃªn) qua máº¡ng CAN
  - Chá»‰ gá»i khi biáº¿n `tempRequested` lÃ  true (cÃ³ yÃªu cáº§u tá»« node chÃ­nh)
  - Tá»± Ä‘á»™ng sá»­ dá»¥ng ID 0x2 Ä‘Ã£ Ä‘áº·t trong setup
- `tempRequested = false`: Äáº·t láº¡i cá» yÃªu cáº§u sau khi Ä‘Ã£ gá»­i dá»¯ liá»‡u


<div align="center">
    <img src="https://cdn.chipstack.vn/zerobase2/can/can-mcp2551-temperature-node-send.png" alt="can-mcp2551-temperature-node-send">
        <p><em>Káº¿t quáº£ khi node xá»­ lÃ½ nhiá»‡t Ä‘á»™ gá»­i tin nháº¯n vá» node chÃ­nh</em></p>
</div>

#### 3. Node xá»­ lÃ½ thá»i gian (Zerobase 2 thá»© hai)

Node nÃ y Ä‘á»c thá»i gian tá»« module RTC DS3231 vÃ  gá»­i vá» node chÃ­nh khi cÃ³ yÃªu cáº§u.

##### Thiáº¿t láº­p ban Ä‘áº§u (hÃ m setup)

```cpp
void setup() {
 Serial.begin(115200);         // Khá»Ÿi táº¡o Serial
 Serial.println("RTC Node Starting");

 Wire.begin();                 // Khá»Ÿi táº¡o I2C cho RTC

 if (!timeIsSet) {             // Náº¿u thá»i gian chÆ°a Ä‘Æ°á»£c Ä‘áº·t
   // CÃ i Ä‘áº·t thá»i gian ban Ä‘áº§u (chá»‰ lÃ m má»™t láº§n)
   rtc.setYear(26);            // NÄƒm 2026
   rtc.setMonth(5);            // ThÃ¡ng 5
   rtc.setDate(5);             // NgÃ y 5
   rtc.setDoW(2);              // Thá»© 2
   rtc.setHour(17);            // 17 giá»
   rtc.setMinute(0);           // 0 phÃºt
   rtc.setSecond(0);           // 0 giÃ¢y
   rtc.setClockMode(false);    // Cháº¿ Ä‘á»™ 24 giá»

   timeIsSet = true;
   Serial.println("Time set successfully");
 }

 readDateTime();               // Äá»c thá»i gian láº§n Ä‘áº§u

 ZBCan1.begin();               // Khá»Ÿi táº¡o CAN
 ZBCan1.setTxId(0x3);          // Äáº·t ID gá»­i tin nháº¯n lÃ  0x3

 uint32_t acceptedIds[] = { 0x1, 0x8 }; // Chá»‰ nháº­n tin nháº¯n tá»« node chÃ­nh
 ZBCan1.configureMultipleFilters(acceptedIds, 2);

 ZBCan1.onReceive(canMessageReceived);

 Serial.println("RTC Node Ready");
}
```

- `Wire.begin()`: Khá»Ÿi táº¡o giao thá»©c I2C Ä‘á»ƒ giao tiáº¿p vá»›i module RTC DS3231
- Khá»‘i lá»‡nh Ä‘iá»u kiá»‡n `if (!timeIsSet)`: Chá»‰ cÃ i Ä‘áº·t thá»i gian ban Ä‘áº§u náº¿u biáº¿n `timeIsSet` lÃ  false
  - Trong thá»±c táº¿, cÃ³ thá»ƒ sá»­ dá»¥ng EEPROM Ä‘á»ƒ lÆ°u tráº¡ng thÃ¡i nÃ y giá»¯a cÃ¡c láº§n khá»Ÿi Ä‘á»™ng
- CÃ¡c hÃ m `rtc.setXXX()`: CÃ i Ä‘áº·t cÃ¡c thÃ nh pháº§n thá»i gian cho module RTC
- `rtc.setClockMode(false)`: CÃ i Ä‘áº·t cháº¿ Ä‘á»™ 24 giá» (false = 24h, true = 12h AM/PM)
- `ZBCan1.setTxId(0x3)`: Äáº·t ID gá»­i tin nháº¯n cá»§a node lÃ  0x3
- `ZBCan1.configureMultipleFilters(acceptedIds, 2)`: Cáº¥u hÃ¬nh bá»™ lá»c Ä‘á»ƒ chá»‰ nháº­n tin nháº¯n cÃ³ ID 0x1 (tá»« node chÃ­nh) vÃ  0x8 (yÃªu cáº§u thá»i gian)

##### Äá»c thá»i gian

```cpp
void readDateTime() {
 bool h12, PM, century;        // Biáº¿n há»— trá»£ cho cÃ¡c hÃ m Ä‘á»c RTC

 // Äá»c cÃ¡c thÃ nh pháº§n thá»i gian
 byte month = rtc.getMonth(century);
 byte day = rtc.getDate();
 byte year = rtc.getYear();
 byte hour = rtc.getHour(h12, PM);
 byte minute = rtc.getMinute();
 byte second = rtc.getSecond();

 // Äá»‹nh dáº¡ng chuá»—i: DD/MM/YY HH:MM:SS
 sprintf(dateTimeStr, "%d/%d/%02d %02d:%02d:%02d",
         day, month, year, hour, minute, second);
}
```

- Biáº¿n `h12`, `PM` vÃ  `century`: Tham sá»‘ Ä‘áº§u ra báº¯t buá»™c cho má»™t sá»‘ hÃ m cá»§a thÆ° viá»‡n DS3231
- CÃ¡c hÃ m `rtc.getXXX()`: Äá»c cÃ¡c thÃ nh pháº§n thá»i gian tá»« module RTC
- `sprintf(dateTimeStr, "...")`: HÃ m Ä‘á»‹nh dáº¡ng chuá»—i tá»« thÆ° viá»‡n C chuáº©n
  - Tham sá»‘ Ä‘áº§u tiÃªn: Chuá»—i Ä‘Ã­ch Ä‘á»ƒ lÆ°u káº¿t quáº£ (máº£ng `dateTimeStr`)
  - Tham sá»‘ thá»© hai: Chuá»—i Ä‘á»‹nh dáº¡ng vá»›i cÃ¡c Ä‘áº·c táº£ chuyá»ƒn Ä‘á»•i
    - `%d`: Hiá»ƒn thá»‹ sá»‘ nguyÃªn tháº­p phÃ¢n
    - `%02d`: Hiá»ƒn thá»‹ sá»‘ nguyÃªn tháº­p phÃ¢n vá»›i Ã­t nháº¥t 2 chá»¯ sá»‘, thÃªm sá»‘ 0 á»Ÿ Ä‘áº§u náº¿u cáº§n
  - CÃ¡c tham sá»‘ tiáº¿p theo: CÃ¡c giÃ¡ trá»‹ sáº½ Ä‘Æ°á»£c chÃ¨n vÃ o chuá»—i theo thá»© tá»±

##### Nháº­n tin nháº¯n

```cpp
void canMessageReceived() {
 uint32_t rxId = ZBCan1.getRxId();

 if (rxId == 0x8 && ZBCan1.isString()) { // Kiá»ƒm tra tin nháº¯n tá»« node chÃ­nh vá»›i ID 0x8
   String message = ZBCan1.getLastStringMessage();
   Serial.print("Message received: ");
   Serial.println(message);

   if (message == "GET_TIME") {          // Náº¿u tin nháº¯n yÃªu cáº§u thá»i gian
     timeRequested = true;               // Äáº·t cá» yÃªu cáº§u thá»i gian
   }
 }
}
```

- TÆ°Æ¡ng tá»± nhÆ° node nhiá»‡t Ä‘á»™, nhÆ°ng láº¯ng nghe ID 0x8 thay vÃ¬ 0x7
- `message == "GET_TIME"`: So sÃ¡nh ná»™i dung tin nháº¯n vá»›i chuá»—i "GET_TIME"
- `timeRequested = true`: Äáº·t cá» bÃ¡o hiá»‡u cÃ³ yÃªu cáº§u gá»­i thá»i gian

<div align="center">
    <img src="https://cdn.chipstack.vn/zerobase2/can/can-mcp2551-rtc-node-receive-msg.png" alt="can-mcp2551-rtc-node-receive">
        <p><em>Káº¿t quáº£ khi node xá»­ lÃ½ thá»i gian nháº­n Ä‘Æ°á»£c tin nháº¯n yÃªu cáº§u gá»­i thá»i gian tá»« node chÃ­nh</em></p>
</div>

##### Gá»­i tin nháº¯n

```cpp
void loop() {
 readDateTime();               // Äá»c thá»i gian hiá»‡n táº¡i

 if (timeRequested) {          // Náº¿u cÃ³ yÃªu cáº§u thá»i gian
   ZBCan1.send(dateTimeStr);   // Gá»­i chuá»—i thá»i gian qua CAN
   Serial.print("Time sent: ");
   Serial.println(dateTimeStr);
   timeRequested = false;      // Äáº·t láº¡i cá» yÃªu cáº§u
 }

 delay(1000);                  // Táº¡m dá»«ng 1 giÃ¢y
}
```

- `ZBCan1.send(dateTimeStr)`: Gá»­i chuá»—i thá»i gian qua máº¡ng CAN
  - Tham sá»‘ lÃ  máº£ng kÃ½ tá»± `dateTimeStr` chá»©a chuá»—i thá»i gian Ä‘Ã£ Ä‘á»‹nh dáº¡ng
  - Tá»± Ä‘á»™ng sá»­ dá»¥ng ID 0x3 Ä‘Ã£ Ä‘áº·t trong setup
- `timeRequested = false`: Äáº·t láº¡i cá» yÃªu cáº§u sau khi Ä‘Ã£ gá»­i dá»¯ liá»‡u

<div align="center">
    <img src="https://cdn.chipstack.vn/zerobase2/can/can-mcp2551-rtc-node-send-msg.png" alt="can-mcp2551-rtc-node-send">
        <p><em>Káº¿t quáº£ khi node xá»­ lÃ½ thá»i gian gá»­i tin nháº¯n vá» node chÃ­nh</em></p>
</div>

#### Tá»•ng quan há»‡ thá»‘ng CAN Bus

Há»‡ thá»‘ng sá»­ dá»¥ng giao thá»©c CAN Ä‘á»ƒ trao Ä‘á»•i dá»¯ liá»‡u giá»¯a cÃ¡c node vá»›i mÃ´ hÃ¬nh yÃªu cáº§u-pháº£n há»“i:

##### Luá»“ng dá»¯ liá»‡u
1. Node chÃ­nh gá»­i yÃªu cáº§u vá»›i ID riÃªng (0x7 cho nhiá»‡t Ä‘á»™, 0x8 cho thá»i gian)
2. CÃ¡c node cáº£m biáº¿n nháº­n yÃªu cáº§u, xá»­ lÃ½ vÃ  gá»­i dá»¯ liá»‡u vá» node chÃ­nh
3. Node chÃ­nh nháº­n dá»¯ liá»‡u tá»« cÃ¡c node (ID 0x2 cho nhiá»‡t Ä‘á»™, ID 0x3 cho thá»i gian)
4. Node chÃ­nh hiá»ƒn thá»‹ dá»¯ liá»‡u lÃªn mÃ n hÃ¬nh LCD

##### Báº£ng ID CAN
| Node           | TX ID | RX ID                      | Chá»©c nÄƒng                            |
|----------------|-------|----------------------------|--------------------------------------|
| Node chÃ­nh     | 0x1/0x7/0x8 | 0x2, 0x3             | Gá»­i yÃªu cáº§u, hiá»ƒn thá»‹ dá»¯ liá»‡u       |
| Node nhiá»‡t Ä‘á»™  | 0x2   | 0x1, 0x7                   | Äá»c nhiá»‡t Ä‘á»™, gá»­i khi cÃ³ yÃªu cáº§u    |
| Node thá»i gian | 0x3   | 0x1, 0x8                   | Äá»c thá»i gian, gá»­i khi cÃ³ yÃªu cáº§u   |

## Káº¿t quáº£

?> Káº¿t quáº£ cuá»‘i cÃ¹ng lÃ  nhiá»‡t Ä‘á»™ vÃ  thá»i gian Ä‘Æ°á»£c hiá»ƒn thá»‹ trÃªn mÃ n hÃ¬nh mÃ n hÃ¬nh lcd

<div align="center">
    <img src="https://cdn.chipstack.vn/zerobase2/can/can-mcp2551-result.gif" alt="can-mcp2551-result">
        <p><em>Káº¿t quáº£ cuá»‘i cÃ¹ng Ä‘Æ°á»£c hiá»ƒn thá»‹ lÃªn mÃ n hÃ¬nh LCD</em></p>
</div>

## Káº¿t luáº­n vÃ  hÆ°á»›ng phÃ¡t triá»ƒn

Há»‡ thá»‘ng sá»­ dá»¥ng giao thá»©c CAN Ä‘á»ƒ giao tiáº¿p giá»¯a cÃ¡c node Zerobase 2, cho phÃ©p truyá»n táº£i dá»¯ liá»‡u nhanh chÃ³ng vÃ  hiá»‡u quáº£. Viá»‡c sá»­ dá»¥ng thÆ° viá»‡n ZBCan giÃºp Ä‘Æ¡n giáº£n hÃ³a quÃ¡ trÃ¬nh láº­p trÃ¬nh vÃ  quáº£n lÃ½ giao tiáº¿p CAN.

Äá»ƒ phÃ¡t triá»ƒn thÃªm tá»« bÃ i há»c nÃ y, báº¡n cÃ³ thá»ƒ thá»±c hiá»‡n cÃ¡c Ã½ tÆ°á»Ÿng sau:

- ThÃªm nhiá»u node cáº£m biáº¿n khÃ¡c nhau (vÃ­ dá»¥: cáº£m biáº¿n Ä‘á»™ áº©m, Ã¡p suáº¥t) vÃ o máº¡ng CAN
- ThÃªm chá»©c nÄƒng lÆ°u trá»¯ dá»¯ liá»‡u lá»‹ch sá»­ vÃ o tháº» SD card hoáº·c EEPROM ngoáº¡i
- PhÃ¡t triá»ƒn tÃ­nh nÄƒng cáº£nh bÃ¡o khi nhiá»‡t Ä‘á»™ vÆ°á»£t ngÆ°á»¡ng (buzzer, Ä‘Ã¨n LED)
- NÃ¢ng cáº¥p giao diá»‡n hiá»ƒn thá»‹ sang mÃ n hÃ¬nh OLED hoáº·c mÃ n hÃ¬nh mÃ u TFT
- Táº¡o giao diá»‡n Ä‘iá»u khiá»ƒn tá»« xa qua ESP8266/ESP32 Ä‘á»ƒ theo dÃµi dá»¯ liá»‡u qua máº¡ng WiFi
- ThÃªm chá»©c nÄƒng Ä‘iá»u khiá»ƒn thiáº¿t bá»‹ dá»±a trÃªn dá»¯ liá»‡u nhiá»‡t Ä‘á»™ (vÃ­ dá»¥: báº­t/táº¯t quáº¡t)
- Cáº£i thiá»‡n kháº£ nÄƒng tiáº¿t kiá»‡m nÄƒng lÆ°á»£ng báº±ng cÃ¡ch Ä‘Æ°a cÃ¡c node vÃ o cháº¿ Ä‘á»™ ngá»§

**ChÃºc báº¡n thÃ nh cÃ´ng!**

[ğŸ  TRá» Vá»€ TRANG Tá»”NG Há»¢P CÃC VÃ Dá»¤](vi/zerobase-2/examples.md)


