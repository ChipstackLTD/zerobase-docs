<br>
<br>
<br>

# Äiá»u khiá»ƒn Relay tá»« xa báº±ng remote há»“ng ngoáº¡i

![ir-remote-circuit](https://cdn.chipstack.vn/zerobase/ir-remote/ir-remote-circuit.jpg)

## Tá»•ng quan

BÃ i hÆ°á»›ng dáº«n nÃ y sáº½ giÃºp báº¡n Ä‘iá»u khiá»ƒn Relay tá»« xa báº±ng remote há»“ng ngoáº¡i.

## Chuáº©n bá»‹

| Linh kiá»‡n | Link mua |
|--- | --- |
| Board Zerobase |[Mua ngay](https://chipstack.vn/san-pham/zerobase/) |
| Breadboard |[Mua ngay](https://chipstack.vn/san-pham/breadboard-830-lo/) |
| DÃ¢y jumper Äá»±c â€“ Äá»±c | [Mua ngay](https://chipstack.vn/san-pham/day-jumper-duc-duc/) |
| DÃ¢y USB Type C |[Mua ngay](https://chipstack.vn/san-pham/day-usb-type-c-1m/) |
| Module relay 5V 2 kÃªnh má»©c tháº¥p |[Mua ngay](https://chipstack.vn/san-pham/module-relay-5v-2-kenh-muc-thap/) |
| Äiá»‡n trá»Ÿ 330Î© |[Mua ngay](https://chipstack.vn/san-pham/dien-tro-1-4w-1/) |
| LED |[Mua ngay](https://chipstack.vn/san-pham/led-5mm-vo-mau/) |
| LED thu há»“ng ngoáº¡i 3 chÃ¢n VS1838B | [Mua ngay](https://chipstack.vn/san-pham/led-thu-hong-ngoai-3-chan-vs1838b/) |
| Remote há»“ng ngoáº¡i 17 phÃ­m | [Mua ngay](https://chipstack.vn/san-pham/remote-hong-ngoai-17-phim/) |

<div align="center">
    <img src="https://cdn.chipstack.vn/default/zerobase-overview.png" alt="zerobase">
    <p><em>Board Zerobase</em></p>
</div>

<br>

<div align="center">
    <img src="https://cdn.chipstack.vn/default/breadboard.png" alt="breadboard">
    <p><em>Breadboard</em></p>
</div>

<br>

<div align="center">
    <img src="https://cdn.chipstack.vn/default/dien-tro-330-ohm.png" alt="dien-tro-330-ohm">
    <p><em>Äiá»‡n trá»Ÿ 330Î©</em></p>
</div>

<br>

<div align="center">
    <img src="https://cdn.chipstack.vn/default/led-do.png" alt="led-do">
    <p><em>LED</em></p>
</div>

<br>

<div align="center">
    <img src="https://cdn.chipstack.vn/default/jumper-wire.png" alt="jumper-wire">
    <p><em>DÃ¢y ná»‘i</em></p>
</div>

<div align="center">
    <img src="https://cdn.chipstack.vn/default/usb-type-c.jpg" alt="button-lcd-usb-type-c">
    <p><em>DÃ¢y USB Type C</em></p>
</div>

<div align="center">
    <img src="https://cdn.chipstack.vn/default/module-relay-5v-2-kenh-muc-thap.jpg" alt="module-relay-5v-2-kenh-muc-thap">
    <p><em>Module relay 5V 2 kÃªnh má»©c tháº¥p</em></p>
</div>

<div align="center">
    <img src="https://cdn.chipstack.vn/zerobase/ir-remote/ir-receiver.png" alt="ir-receiver">
    <p><em>LED thu há»“ng ngoáº¡i 3 chÃ¢n VS1838B</em></p>
</div>

<div align="center">
    <img src="https://cdn.chipstack.vn/zerobase/ir-remote/ir-remote.jpg" alt="remote">
    <p><em>Remote há»“ng ngoáº¡i 17 phÃ­m</em></p>
</div>


## NguyÃªn lÃ½ hoáº¡t Ä‘á»™ng

?> Sá»­ dá»¥ng module VS1838B Ä‘á»ƒ nháº­n tÃ­n hiá»‡u há»“ng ngoáº¡i tá»« remote Ä‘iá»u khiá»ƒn. TÃ­n hiá»‡u nÃ y Ä‘Æ°á»£c mÃ£ hÃ³a theo chuáº©n NEC vá»›i chuá»—i xung gá»“m pháº§n má»Ÿ Ä‘áº§u vÃ  32 bit dá»¯ liá»‡u. Zerobase sáº½ Ä‘á»c cÃ¡c xung nÃ y thÃ´ng qua chÃ¢n tÃ­n hiá»‡u IR vÃ  Ä‘o thá»i gian Ä‘á»ƒ xÃ¡c Ä‘á»‹nh giÃ¡ trá»‹ tá»«ng bit.

?> ChÆ°Æ¡ng trÃ¬nh sá»­ dá»¥ng cÃ¡c hÃ m Ä‘o xung Ä‘á»ƒ phÃ¢n biá»‡t giá»¯a bit 0 vÃ  bit 1 dá»±a vÃ o Ä‘á»™ rá»™ng xung HIGH. Sau khi hoÃ n táº¥t quÃ¡ trÃ¬nh giáº£i mÃ£, má»™t giÃ¡ trá»‹ 32 bit (mÃ£ lá»‡nh) sáº½ Ä‘Æ°á»£c thu Ä‘Æ°á»£c. MÃ£ nÃ y sau Ä‘Ã³ Ä‘Æ°á»£c Ä‘á»‘i chiáº¿u vá»›i cÃ¡c giÃ¡ trá»‹ Ä‘Ã£ láº­p trÃ¬nh sáºµn Ä‘á»ƒ xÃ¡c Ä‘á»‹nh hÃ nh Ä‘á»™ng tÆ°Æ¡ng á»©ng.

?> TÃ¹y theo mÃ£ lá»‡nh nháº­n Ä‘Æ°á»£c, Zerobase sáº½ Ä‘iá»u khiá»ƒn báº­t hoáº·c táº¯t relay qua cÃ¡c chÃ¢n sá»‘ 10 vÃ  11. VÃ¬ relay sá»­ dá»¥ng má»©c Ä‘iá»u khiá»ƒn tháº¥p, ghi LOW sáº½ báº­t vÃ  HIGH sáº½ táº¯t. Qua Ä‘Ã³, ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ Ä‘iá»u khiá»ƒn thiáº¿t bá»‹ Ä‘iá»‡n tá»« xa nhÆ° báº­t/táº¯t Ä‘Ã¨n, quáº¡t hoáº·c á»• cáº¯m thÃ´ng minh má»™t cÃ¡ch dá»… dÃ ng vÃ  linh hoáº¡t.

## SÆ¡ Ä‘á»“ káº¿t ná»‘i

![irir-receiver-vs1838b-pinout](https://cdn.chipstack.vn/zerobase/ir-remote/ir-receiver-vs1838b-pinout.png)

![zerobase-ir-remote-pins](https://cdn.chipstack.vn/zerobase/ir-remote/zerobase-ir-remote-pins.png)

Sá»­ dá»¥ng chÃ¢n D2 cá»§a board Zerobase Ä‘á»ƒ ná»‘i vá»›i chÃ¢n tÃ­n hiá»‡u cá»§a LED thu há»“ng ngoáº¡i. ChÃ¢n 5V ná»‘i vá»›i chÃ¢n VCC cá»§a LED thu há»“ng ngoáº¡i, chÃ¢n GND ná»‘i vá»›i chÃ¢n GND cá»§a LED thu há»“ng ngoáº¡i.

ChÃ¢n D10 vÃ  D11 Ä‘Æ°á»£c káº¿t ná»‘i vá»›i chÃ¢n IN1 vÃ  IN2 cá»§a relay.
ChÃ¢n VCC cá»§a relay ná»‘i vá»›i chÃ¢n 5V cá»§a board Zerobase, chÃ¢n GND ná»‘i vá»›i chÃ¢n GND cá»§a board Zerobase.

ChÃ¢n anode (+) cá»§a LED Ä‘á» ná»‘i ná»‘i vá»›i NO (Normally Open) cá»§a relay 1, tá»« COM (Common) cá»§a relay 1 ná»‘i vá»›i nguá»“n 5V. ChÃ¢n cathode (-) cá»§a LED ná»‘i vá»›i má»™t chÃ¢n cá»§a Ä‘iá»‡n trá»Ÿ 330Î©, chÃ¢n cÃ²n láº¡i cá»§a Ä‘iá»‡n trá»Ÿ ná»‘i vá»›i GND cá»§a board Zerobase.

LED xanh lÃ¡ ná»‘i tÆ°Æ¡ng tá»± nhÆ° LED Ä‘á», nhÆ°ng ná»‘i vá»›i relay 2.

![ir-remote-schematic](https://cdn.chipstack.vn/zerobase/ir-remote/ir-remote-schematic.png)

![ir-remote-circuit](https://cdn.chipstack.vn/zerobase/ir-remote/ir-remote-circuit.jpg)

## Code

```cpp
// Khai bÃ¡o chÃ¢n nháº­n tÃ­n hiá»‡u IR
const int IR_PIN 2  // ChÃ¢n D2 káº¿t ná»‘i vá»›i chÃ¢n OUT cá»§a VS1838B

// Thá»i gian chá» timeout (10ms) cho tá»«ng bÆ°á»›c khi chá» tráº¡ng thÃ¡i HIGH hoáº·c LOW
const int TIMEOUT_US 10000

// Khai bÃ¡o chÃ¢n Ä‘iá»u khiá»ƒn relay
const int RELAY1_PIN 10  // Relay 1 káº¿t ná»‘i chÃ¢n D10
const int RELAY2_PIN 11  // Relay 2 káº¿t ná»‘i chÃ¢n D11

void setup() {
  pinMode(IR_PIN, INPUT);  // Äáº·t chÃ¢n IR lÃ  Ä‘áº§u vÃ o Ä‘á»ƒ nháº­n tÃ­n hiá»‡u tá»« remote

  pinMode(RELAY1_PIN, OUTPUT);  // Äáº·t chÃ¢n relay 1 lÃ  Ä‘áº§u ra
  pinMode(RELAY2_PIN, OUTPUT);  // Äáº·t chÃ¢n relay 2 lÃ  Ä‘áº§u ra

  // Relay má»©c tháº¥p: LOW lÃ  báº­t, HIGH lÃ  táº¯t
  digitalWrite(RELAY1_PIN, HIGH);  // Táº¯t relay 1 lÃºc khá»Ÿi Ä‘á»™ng
  digitalWrite(RELAY2_PIN, HIGH);  // Táº¯t relay 2 lÃºc khá»Ÿi Ä‘á»™ng
}

// HÃ m chá» cho Ä‘áº¿n khi IR_PIN cÃ³ tráº¡ng thÃ¡i 'state', hoáº·c háº¿t thá»i gian timeout_us
bool waitForState(int state, unsigned long timeout_us) {
  unsigned long start = micros();  // LÆ°u thá»i Ä‘iá»ƒm báº¯t Ä‘áº§u
  while (digitalRead(IR_PIN) != state) {
    if ((micros() - start) > timeout_us) {
      return false;  // Náº¿u quÃ¡ thá»i gian chá», thoÃ¡t vÃ  tráº£ vá» false
    }
  }
  return true;  // Náº¿u Ä‘áº¿n tráº¡ng thÃ¡i Ä‘Ãºng, tráº£ vá» true
}

// HÃ m Ä‘á»c tÃ­n hiá»‡u IR theo giao thá»©c NEC
unsigned long readIR() {
  // BÆ°á»›c 1: Chá» tÃ­n hiá»‡u báº¯t Ä‘áº§u (Start signal) = 9ms LOW + 4.5ms HIGH
  if (!waitForState(LOW, TIMEOUT_US)) return 0;  // Chá» báº¯t Ä‘áº§u xuá»‘ng LOW
  unsigned long t1 = micros();
  if (!waitForState(HIGH, TIMEOUT_US)) return 0;  // Káº¿t thÃºc pháº§n LOW
  unsigned long t2 = micros();
  if ((t2 - t1) < 8000 || (t2 - t1) > 10000) return 0;  // Kiá»ƒm tra cÃ³ pháº£i 9ms khÃ´ng

  // BÆ°á»›c 2: Chá» pháº§n HIGH 4.5ms
  t1 = micros();
  if (!waitForState(LOW, TIMEOUT_US)) return 0;
  t2 = micros();
  if ((t2 - t1) < 4000 || (t2 - t1) > 5000) return 0;  // Kiá»ƒm tra cÃ³ pháº£i 4.5ms khÃ´ng

  // BÆ°á»›c 3: Äá»c 32 bit dá»¯ liá»‡u tá»« remote
  unsigned long data = 0;
  for (int i = 0; i < 32; i++) {
    if (!waitForState(HIGH, TIMEOUT_US)) return 0;  // Báº¯t Ä‘áº§u HIGH cá»§a bit
    t1 = micros();
    if (!waitForState(LOW, TIMEOUT_US)) return 0;  // Káº¿t thÃºc HIGH
    t2 = micros();

    unsigned long pulse = t2 - t1;  // Äo thá»i gian HIGH

    if (pulse > 1000) {
      data = (data << 1) | 1;  // Náº¿u HIGH dÃ i (~1.69ms) => bit 1
    } else {
      data = (data << 1);  // Náº¿u HIGH ngáº¯n (~0.56ms) => bit 0
    }
  }

  return data;  // Tráº£ vá» mÃ£ IR Ä‘á»c Ä‘Æ°á»£c
}

void loop() {
  unsigned long irCode = readIR();  // Gá»i hÃ m Ä‘á»c tÃ­n hiá»‡u IR

  if (irCode != 0) {  // Náº¿u cÃ³ mÃ£ IR nháº­n Ä‘Æ°á»£c

    // Xá»­ lÃ½ mÃ£ lá»‡nh tá»« remote
    switch (irCode) {
      case 0xFFA25D:  // NÃºt: báº­t relay 1
        digitalWrite(RELAY1_PIN, LOW);
        break;

      case 0xFF629D:  // NÃºt: báº­t relay 2
        digitalWrite(RELAY2_PIN, LOW);
        break;

      case 0xFFE21D:  // NÃºt: táº¯t relay 1
        digitalWrite(RELAY1_PIN, HIGH);
        break;

      case 0xFF22DD:  // NÃºt: táº¯t relay 2
        digitalWrite(RELAY2_PIN, HIGH);
        break;

      case 0xFF02FD:  // NÃºt: báº­t cáº£ 2 relay
        digitalWrite(RELAY1_PIN, LOW);
        digitalWrite(RELAY2_PIN, LOW);
        break;

      case 0xFFC23D:  // NÃºt: táº¯t cáº£ 2 relay
        digitalWrite(RELAY1_PIN, HIGH);
        digitalWrite(RELAY2_PIN, HIGH);
        break;
    }
  }
}
```

Copy Ä‘oáº¡n code trÃªn vÃ  dÃ¡n vÃ o Arduino IDE, káº¿t quáº£ sáº½ Ä‘Æ°á»£c nhÆ° hÃ¬nh bÃªn dÆ°á»›i.

![ir-remote-code](https://cdn.chipstack.vn/zerobase/ir-remote/ir-remote-code.png "ir-remote-code")

### BiÃªn dá»‹ch

Nháº¥n vÃ o biá»ƒu tÆ°á»£ng Verify Ä‘á»ƒ biÃªn dá»‹ch code.

![verify-code](https://cdn.chipstack.vn/default/verify-code.png "verify-code]")

### Thá»±c hiá»‡n náº¡p code
Cuá»‘i cÃ¹ng báº¡n thá»±c hiá»‡n náº¡p code vÃ o board Zerobase. Náº¿u chÆ°a biáº¿t cÃ¡ch náº¡p code cho Zerobase, báº¡n cÃ³ thá»ƒ tham kháº£o [táº¡i Ä‘Ã¢y](https://zerobase.chipstack.vn/#/vi/zerobase/quickstart).

### Giáº£i thÃ­ch code

DÃ²ng nÃ y khai bÃ¡o háº±ng sá»‘ `IR_PIN` cÃ³ giÃ¡ trá»‹ lÃ  2, tÆ°Æ¡ng á»©ng vá»›i chÃ¢n D2 trÃªn Arduino. ChÃ¢n nÃ y Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ nháº­n tÃ­n hiá»‡u há»“ng ngoáº¡i tá»« remote thÃ´ng qua cáº£m biáº¿n VS1838B.
```cpp
// Khai bÃ¡o chÃ¢n nháº­n tÃ­n hiá»‡u IR
const int IR_PIN = 2;  // ChÃ¢n D2 káº¿t ná»‘i vá»›i chÃ¢n OUT cá»§a VS1838B
```

Khai bÃ¡o háº±ng sá»‘ `TIMEOUT_US` cÃ³ giÃ¡ trá»‹ lÃ  10000 micro giÃ¢y (tÆ°Æ¡ng Ä‘Æ°Æ¡ng 10ms). GiÃ¡ trá»‹ nÃ y Ä‘Æ°á»£c sá»­ dá»¥ng lÃ m thá»i gian chá» tá»‘i Ä‘a khi kiá»ƒm tra tÃ­n hiá»‡u IR á»Ÿ cÃ¡c tráº¡ng thÃ¡i HIGH hoáº·c LOW.
```cpp
// Thá»i gian chá» timeout (10ms) cho tá»«ng bÆ°á»›c khi chá» tráº¡ng thÃ¡i HIGH hoáº·c LOW
const int TIMEOUT_US = 10000;
```

Hai dÃ²ng nÃ y khai bÃ¡o chÃ¢n Ä‘iá»u khiá»ƒn relay: `RELAY1_PIN` lÃ  chÃ¢n D10 dÃ¹ng Ä‘á»ƒ Ä‘iá»u khiá»ƒn relay 1, vÃ  `RELAY2_PIN` lÃ  chÃ¢n D11 dÃ¹ng Ä‘á»ƒ Ä‘iá»u khiá»ƒn relay 2.
```cpp
// Khai bÃ¡o chÃ¢n Ä‘iá»u khiá»ƒn relay
const int RELAY1_PIN = 10;  // Relay 1 káº¿t ná»‘i chÃ¢n D10
const int RELAY2_PIN = 11;  // Relay 2 káº¿t ná»‘i chÃ¢n D11
```

HÃ m `setup()` Ä‘Æ°á»£c Arduino gá»i má»™t láº§n duy nháº¥t khi báº¯t Ä‘áº§u cháº¡y chÆ°Æ¡ng trÃ¬nh.
```cpp
void setup() {
```

Cáº¥u hÃ¬nh chÃ¢n `IR_PIN` (D2) lÃ  Ä‘áº§u vÃ o Ä‘á»ƒ cÃ³ thá»ƒ Ä‘á»c tÃ­n hiá»‡u tá»« cáº£m biáº¿n há»“ng ngoáº¡i.
```cpp
  pinMode(IR_PIN, INPUT);  // Äáº·t chÃ¢n IR lÃ  Ä‘áº§u vÃ o Ä‘á»ƒ nháº­n tÃ­n hiá»‡u tá»« remote
```

Cáº¥u hÃ¬nh chÃ¢n `RELAY1_PIN` (D10) lÃ  Ä‘áº§u ra Ä‘á»ƒ Ä‘iá»u khiá»ƒn relay 1.
```cpp
  pinMode(RELAY1_PIN, OUTPUT);  // Äáº·t chÃ¢n relay 1 lÃ  Ä‘áº§u ra
```

Cáº¥u hÃ¬nh chÃ¢n `RELAY2_PIN` (D11) lÃ  Ä‘áº§u ra Ä‘á»ƒ Ä‘iá»u khiá»ƒn relay 2.
```cpp
  pinMode(RELAY2_PIN, OUTPUT);  // Äáº·t chÃ¢n relay 2 lÃ  Ä‘áº§u ra
```

Äáº·t chÃ¢n D10 á»Ÿ má»©c HIGH, tá»©c táº¯t relay 1 theo logic relay má»©c tháº¥p.
```cpp
  digitalWrite(RELAY1_PIN, HIGH);  // Táº¯t relay 1 lÃºc khá»Ÿi Ä‘á»™ng
```

Äáº·t chÃ¢n D11 á»Ÿ má»©c HIGH, tá»©c táº¯t relay 2 theo logic relay má»©c tháº¥p.
```cpp
  digitalWrite(RELAY2_PIN, HIGH);  // Táº¯t relay 2 lÃºc khá»Ÿi Ä‘á»™ng
```

Káº¿t thÃºc hÃ m `setup()`.
```cpp
}
```

Khai bÃ¡o hÃ m `waitForState`, nháº­n vÃ o 2 tham sá»‘: `state` (tráº¡ng thÃ¡i cáº§n chá»: HIGH hoáº·c LOW) vÃ  `timeout_us` (thá»i gian chá» tá»‘i Ä‘a).
```cpp
bool waitForState(int state, unsigned long timeout_us) {
```

LÆ°u láº¡i thá»i Ä‘iá»ƒm hiá»‡n táº¡i tÃ­nh báº±ng micro giÃ¢y Ä‘á»ƒ tÃ­nh toÃ¡n thá»i gian chá».
```cpp
  unsigned long start = micros();  // LÆ°u thá»i Ä‘iá»ƒm báº¯t Ä‘áº§u
```

Láº·p liÃªn tá»¥c Ä‘áº¿n khi tÃ­n hiá»‡u Ä‘á»c tá»« chÃ¢n IR báº±ng vá»›i tráº¡ng thÃ¡i mong muá»‘n (`state`).
```cpp
  while (digitalRead(IR_PIN) != state) {
```

Kiá»ƒm tra náº¿u thá»i gian chá» vÆ°á»£t quÃ¡ `timeout_us` thÃ¬ káº¿t thÃºc vÃ²ng láº·p.
```cpp
    if ((micros() - start) > timeout_us) {
```

Tráº£ vá» `false` náº¿u khÃ´ng Ä‘áº¡t Ä‘Æ°á»£c tráº¡ng thÃ¡i mong muá»‘n trong thá»i gian cho phÃ©p.
```cpp
      return false;  // Náº¿u quÃ¡ thá»i gian chá», thoÃ¡t vÃ  tráº£ vá» false
```

Káº¿t thÃºc Ä‘iá»u kiá»‡n `if`.
```cpp
    }
```

Káº¿t thÃºc vÃ²ng láº·p `while`.
```cpp
  }
```

Tráº£ vá» `true` náº¿u tÃ­n hiá»‡u Ä‘Ã£ Ä‘áº¡t tráº¡ng thÃ¡i mong muá»‘n.
```cpp
  return true;  // Náº¿u Ä‘áº¿n tráº¡ng thÃ¡i Ä‘Ãºng, tráº£ vá» true
```

Káº¿t thÃºc hÃ m `waitForState`.
```cpp
}
```

Khai bÃ¡o hÃ m `readIR`, tráº£ vá» mÃ£ tÃ­n hiá»‡u IR dáº¡ng sá»‘ nguyÃªn khÃ´ng dáº¥u 32-bit.
```cpp
unsigned long readIR() {
```

Chá» tÃ­n hiá»‡u báº¯t Ä‘áº§u: tÃ­n hiá»‡u pháº£i xuá»‘ng má»©c LOW, náº¿u khÃ´ng Ä‘Ãºng thá»i gian thÃ¬ tráº£ vá» 0.
```cpp
  if (!waitForState(LOW, TIMEOUT_US)) return 0;
```

LÆ°u láº¡i thá»i Ä‘iá»ƒm báº¯t Ä‘áº§u cá»§a má»©c LOW.
```cpp
  unsigned long t1 = micros();
```

Chá» káº¿t thÃºc má»©c LOW Ä‘á»ƒ chuyá»ƒn sang HIGH. Náº¿u vÆ°á»£t thá»i gian thÃ¬ tráº£ vá» 0.
```cpp
  if (!waitForState(HIGH, TIMEOUT_US)) return 0;
```

LÆ°u thá»i Ä‘iá»ƒm báº¯t Ä‘áº§u cá»§a má»©c HIGH.
```cpp
  unsigned long t2 = micros();
```

Kiá»ƒm tra xem khoáº£ng thá»i gian má»©c LOW cÃ³ náº±m trong khoáº£ng 9ms (8000-10000us) khÃ´ng. Náº¿u khÃ´ng Ä‘Ãºng thÃ¬ tráº£ vá» 0.
```cpp
  if ((t2 - t1) < 8000 || (t2 - t1) > 10000) return 0;
```

LÆ°u láº¡i thá»i Ä‘iá»ƒm báº¯t Ä‘áº§u má»©c HIGH cá»§a pháº§n 4.5ms tiáº¿p theo.
```cpp
  t1 = micros();
```

Chá» káº¿t thÃºc má»©c HIGH (chuyá»ƒn sang LOW). Náº¿u khÃ´ng xáº£y ra Ä‘Ãºng thá»i Ä‘iá»ƒm thÃ¬ tráº£ vá» 0.
```cpp
  if (!waitForState(LOW, TIMEOUT_US)) return 0;
```

LÆ°u láº¡i thá»i Ä‘iá»ƒm báº¯t Ä‘áº§u má»©c LOW.
```cpp
  t2 = micros();
```

Kiá»ƒm tra Ä‘á»™ dÃ i má»©c HIGH cÃ³ náº±m trong khoáº£ng 4.5ms khÃ´ng (4000-5000us). Náº¿u sai thÃ¬ tráº£ vá» 0.
```cpp
  if ((t2 - t1) < 4000 || (t2 - t1) > 5000) return 0;
```

Táº¡o biáº¿n `data` Ä‘á»ƒ lÆ°u dá»¯ liá»‡u nháº­n Ä‘Æ°á»£c tá»« remote.
```cpp
  unsigned long data = 0;
```

Báº¯t Ä‘áº§u vÃ²ng láº·p Ä‘á»c 32 bit dá»¯ liá»‡u tá»« remote.
```cpp
  for (int i = 0; i < 32; i++) {
```

Chá» báº¯t Ä‘áº§u tÃ­n hiá»‡u HIGH cá»§a tá»«ng bit.
```cpp
    if (!waitForState(HIGH, TIMEOUT_US)) return 0;
```

LÆ°u thá»i Ä‘iá»ƒm báº¯t Ä‘áº§u má»©c HIGH.
```cpp
    t1 = micros();
```

Chá» káº¿t thÃºc má»©c HIGH (báº¯t Ä‘áº§u má»©c LOW).
```cpp
    if (!waitForState(LOW, TIMEOUT_US)) return 0;
```

LÆ°u thá»i Ä‘iá»ƒm báº¯t Ä‘áº§u má»©c LOW.
```cpp
    t2 = micros();
```

TÃ­nh thá»i gian mÃ  tÃ­n hiá»‡u giá»¯ má»©c HIGH.
```cpp
    unsigned long pulse = t2 - t1;
```

Náº¿u khoáº£ng thá»i gian HIGH > 1000us (tÆ°Æ¡ng Ä‘Æ°Æ¡ng 1.69ms), Ä‘Ã³ lÃ  bit 1.
```cpp
    if (pulse > 1000) {
```

Dá»‹ch trÃ¡i `data` 1 bit vÃ  gÃ¡n thÃªm 1 vÃ o bit cuá»‘i cÃ¹ng.
```cpp
      data = (data << 1) | 1;
```

NgÆ°á»£c láº¡i, náº¿u thá»i gian ngáº¯n hÆ¡n thÃ¬ Ä‘Ã³ lÃ  bit 0.
```cpp
    } else {
```

Dá»‹ch trÃ¡i `data` 1 bit vÃ  gÃ¡n thÃªm 0.
```cpp
      data = (data << 1);
```

Káº¿t thÃºc Ä‘iá»u kiá»‡n `if-else`.
```cpp
    }
```

Káº¿t thÃºc vÃ²ng láº·p Ä‘á»c 32 bit.
```cpp
  }
```

Tráº£ vá» mÃ£ Ä‘iá»u khiá»ƒn Ä‘á»c Ä‘Æ°á»£c tá»« remote.
```cpp
  return data;  // Tráº£ vá» mÃ£ IR Ä‘á»c Ä‘Æ°á»£c
```

Káº¿t thÃºc hÃ m `readIR()`.
```cpp
}
```

Trong hÃ m `loop()`, gá»i hÃ m `readIR()` Ä‘á»ƒ Ä‘á»c mÃ£ IR tá»« remote.
```cpp
void loop() {
  unsigned long irCode = readIR();  // Gá»i hÃ m Ä‘á»c tÃ­n hiá»‡u IR
```

Náº¿u mÃ£ IR khÃ¡c 0, tá»©c lÃ  cÃ³ tÃ­n hiá»‡u tá»« remote.
```cpp
  if (irCode != 0) {  // Náº¿u cÃ³ mÃ£ IR nháº­n Ä‘Æ°á»£c
```

Xá»­ lÃ½ mÃ£ lá»‡nh tá»« remote báº±ng cÃ¡ch sá»­ dá»¥ng cáº¥u trÃºc `switch-case`.
```cpp
    // Xá»­ lÃ½ mÃ£ lá»‡nh tá»« remote
    switch (irCode)
```

Náº¿u mÃ£ lá»‡nh há»£p lá»‡ 1 trong cÃ¡c mÃ£ lá»‡nh Ä‘Ã£ Ä‘á»‹nh nghÄ©a, thá»±c hiá»‡n báº­t, táº¯t, báº­t táº¥t cáº£ hoáº·c táº¯t táº¥t cáº£ relay.
```cpp
      case 0xFFA25D:  // NÃºt: báº­t relay 1
        digitalWrite(RELAY1_PIN, LOW);
        break;

      case 0xFF629D:  // NÃºt: báº­t relay 2
        digitalWrite(RELAY2_PIN, LOW);
        break;

      case 0xFFE21D:  // NÃºt: táº¯t relay 1
        digitalWrite(RELAY1_PIN, HIGH);
        break;

      case 0xFF22DD:  // NÃºt: táº¯t relay 2
        digitalWrite(RELAY2_PIN, HIGH);
        break;

      case 0xFF02FD:  // NÃºt: báº­t cáº£ 2 relay
        digitalWrite(RELAY1_PIN, LOW);
        digitalWrite(RELAY2_PIN, LOW);
        break;

      case 0xFFC23D:  // NÃºt: táº¯t cáº£ 2 relay
        digitalWrite(RELAY1_PIN, HIGH);
        digitalWrite(RELAY2_PIN, HIGH);
        break;
```

## Káº¿t quáº£

?> Khi nháº¥n nÃºt trÃªn remote, relay sáº½ báº­t hoáº·c táº¯t tÆ°Æ¡ng á»©ng vá»›i mÃ£ lá»‡nh Ä‘Ã£ láº­p trÃ¬nh. Báº¡n cÃ³ thá»ƒ Ä‘iá»u khiá»ƒn thiáº¿t bá»‹ Ä‘iá»‡n tá»« xa má»™t cÃ¡ch dá»… dÃ ng vÃ  tiá»‡n lá»£i.

<div align="center">
    <img src="https://cdn.chipstack.vn/zerobase/ir-remote/ir-remote-result.gif" alt="ir-remote-result">
    <p><em>Äiá»u khiá»ƒn Relay tá»« xa báº±ng remote há»“ng ngoáº¡i</em></p>
</div>

## Káº¿t luáº­n vÃ  hÆ°á»›ng phÃ¡t triá»ƒn

Báº¡n Ä‘Ã£ hoÃ n thÃ nh viá»‡c Ä‘iá»u khiá»ƒn Relay tá»« xa báº±ng remote há»“ng ngoáº¡i. Báº¡n cÃ³ thá»ƒ má»Ÿ rá»™ng dá»± Ã¡n nÃ y Ä‘á»ƒ Ä‘iá»u khiá»ƒn nhiá»u thiáº¿t bá»‹ khÃ¡c nhau hoáº·c káº¿t há»£p vá»›i cÃ¡c cáº£m biáº¿n khÃ¡c Ä‘á»ƒ táº¡o ra cÃ¡c á»©ng dá»¥ng thÃ´ng minh hÆ¡n.

Äá»ƒ phÃ¡t triá»ƒn thÃªm tá»« bÃ i há»c nÃ y, báº¡n cÃ³ thá»ƒ thá»­ cÃ¡c Ã½ tÆ°á»Ÿng sau:

- ThÃªm nhiá»u nÃºt trÃªn remote Ä‘á»ƒ Ä‘iá»u khiá»ƒn nhiá»u thiáº¿t bá»‹ khÃ¡c nhau.
- Káº¿t há»£p vá»›i cáº£m biáº¿n nhiá»‡t Ä‘á»™ hoáº·c Ä‘á»™ áº©m Ä‘á»ƒ tá»± Ä‘á»™ng báº­t/táº¯t thiáº¿t bá»‹ dá»±a trÃªn Ä‘iá»u kiá»‡n mÃ´i trÆ°á»ng.
- Thay vÃ¬ Ä‘iá»u khiá»ƒn LED, báº¡n cÃ³ thá»ƒ Ä‘iá»u khiá»ƒn cÃ¡c thiáº¿t bá»‹ Ä‘iá»‡n khÃ¡c nhÆ° quáº¡t, Ä‘Ã¨n, hoáº·c á»• cáº¯m thÃ´ng minh.

**ChÃºc báº¡n thÃ nh cÃ´ng!**

[ğŸ  TRá» Vá»€ TRANG Tá»”NG Há»¢P CÃC VÃ Dá»¤](vi/zerobase/examples.md)

